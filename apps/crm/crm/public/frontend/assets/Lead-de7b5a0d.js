import{_ as Le,a as Ee}from"./Resizer-90c7afcc.js";import{_ as Ve}from"./FadedScrollableDiv-3bd2f113.js";import{u as Re,_ as Ae,a as Se,b as Te,A as ee,S as $e,c as De}from"./useActiveTabManager-5bcbed2e.js";import{E as ze}from"./MultiSelectEmailInput-5f9a8434.js";import{E as Fe}from"./Email2Icon-49565498.js";import{C as qe}from"./CommentIcon-aa645985.js";import{D as Ne}from"./DetailsIcon-5fbd1b96.js";import{P as ae}from"./PhoneIcon-cf282ece.js";import{T as Ue}from"./TaskIcon-95e40b66.js";import{N as Oe}from"./NoteModal-ef63f4f5.js";import{W as Pe}from"./WhatsAppIcon-88b15828.js";import{I as Be}from"./IndicatorIcon-81343f13.js";import{C as je}from"./CameraIcon-064319e5.js";import{L as We}from"./LinkIcon-62b1d974.js";import{O as Ge}from"./OrganizationsIcon-64c9b845.js";import{C as Qe}from"./ContactsIcon-4e391f66.js";import{c as He,i as Je,E as Ke,_ as te,w as Xe}from"./DragVerticalIcon-56a1fcba.js";import{_ as Ye}from"./LayoutHeader-bf851e4e.js";import{S as Ze,g as ea}from"./view-4ccef3d8.js";import{F as aa}from"./FieldLayout-9051362d.js";import{_ as se}from"./CustomActions-cc223af8.js";import{u as ta,g as sa,b as oa,s as la,d as na,v as ia,a as ra,o as da}from"./index-1be1092b.js";import{u as ua,_ as ca,c as ma,q as pa}from"./modals-6b779b18.js";import{g as _a}from"./settings-efea4d57.js";import{s as fa,l as v,z as U,G as f,E as K,a as va,j as O,A as ga,k as ya,v as ba,c as E,u as e,g as p,w as r,p as _,b as l,H as X,F as ha,h as Ca,B as xa,J as wa,e as P,f as d,n as ka,d as i,t as g,y as Ia,C as Ma,_ as S,I as La}from"./index-77a1adb3.js";import{s as Ea}from"./statuses-2b43883f.js";import{_ as Va}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c9c1b9c8.js";import{_ as oe}from"./Dropdown.vue_vue_type_script_setup_true_lang-20f66514.js";import{F as Ra}from"./FileUploader-1509b35b.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-1c082bf5.js";import{u as Aa}from"./helpCenter-caf03f7d.js";import"./CalendarIcon-f8132aad.js";import"./CallLogModal-0a4bfef6.js";import"./ArrowUpRightIcon-8e3aac11.js";import"./LeadsIcon-788f061a.js";import"./DealsIcon-b1eef88d.js";import"./TaskModal-f9c99550.js";import"./MultipleAvatar-812974f4.js";import"./IconPicker-32bf6d73.js";import"./Popover-23375de3.js";import"./EmailTemplateModal-8d3b6520.js";import"./AssignmentModal-615be241.js";import"./label-ea862e17.js";const Sa={key:1,class:"flex h-full overflow-hidden"},Ta={class:"flex items-center justify-start gap-5 border-b p-5"},$a={class:"group relative size-12"},Da={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},za={class:"flex flex-col gap-2.5 truncate"},Fa={class:"truncate text-2xl font-medium text-ink-gray-9"},qa={class:"flex gap-1.5"},Na={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ua={class:"mb-6 flex items-center justify-between"},Oa={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Pa={class:"flex items-center gap-1"},Ba={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},ja={class:"block text-base"},Wa={class:"ml-6 text-ink-gray-9"},Ga={class:"flex items-center justify-between text-base"},Qa={key:1,class:"mt-2.5 text-base"},Ha={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},Ja={class:"block text-base"},Ka={class:"ml-6 text-ink-gray-9"},Xa={class:"flex items-center justify-between text-base"},Ya={key:1,class:"mt-2.5 text-base"},Za={key:0,class:"h-px w-full border-t my-6"},Bt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(ne){const{brand:ie}=_a(),{user:re}=fa(),{isManager:de}=ta(),{$dialog:ue,$socket:ce,makeCall:me}=sa(),{statusOptions:Y,getLeadStatus:pe,getDealStatus:_e}=Ea(),{doctypeMeta:fe}=oa("CRM Lead"),{updateOnboardingStep:ve}=Aa("frappecrm"),y=Ca(),T=xa(),V=ne,$=v(""),B=v(""),s=U({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:V.leadId},cache:["lead",V.leadId],onSuccess:a=>{$.value="",B.value="",la(s,{doc:a,$dialog:ue,$socket:ce,router:T,toast:f,updateField:F,createToast:f.create,deleteDoc:Ce,resource:{lead:s,sections:z},call:K})},onError:a=>{var t,n;(t=a.messages)!=null&&t[0]?($.value=__("Not permitted"),B.value=__((n=a.messages)==null?void 0:n[0])):T.push({name:"Leads"})}});va(()=>{s.data||s.fetch()});const j=v(!1),W=v(!1);function ge(a,t,n){t=Array.isArray(a)?"":t,!(!Array.isArray(a)&&ye(a,t))&&U({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:V.leadId,fieldname:a,value:t},auto:!0,onSuccess:()=>{s.reload(),j.value=!0,f.success(__("Lead updated successfully")),n==null||n()},onError:c=>{var I;f.error(((I=c.messages)==null?void 0:I[0])||__("Error updating lead"))}})}function ye(a,t){var c;let n=s.data.fields_meta||{};return(c=n[a])!=null&&c.reqd&&!t?(f.error(__("{0} is a required field",[n[a].label])),!0):!1}const be=O(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];if(y.query.view||y.query.viewType){let t=ea(y.query.view,y.query.viewType,"CRM Lead");t&&a.push({label:__(t.label),icon:t.icon,route:{name:"Leads",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return a.push({label:D.value,route:{name:"Lead",params:{leadId:s.data.name}}}),a}),D=O(()=>{var t,n;let a=((t=fe["CRM Lead"])==null?void 0:t.title_field)||"name";return((n=s.data)==null?void 0:n[a])||V.leadId});ga(()=>({title:D.value,icon:ie.favicon}));const R=O(()=>[{name:"Activity",label:__("Activity"),icon:De},{name:"Emails",label:__("Emails"),icon:ze},{name:"Comments",label:__("Comments"),icon:qe},{name:"Data",label:__("Data"),icon:Ne},{name:"Calls",label:__("Calls"),icon:ae},{name:"Tasks",label:__("Tasks"),icon:Ue},{name:"Notes",label:__("Notes"),icon:Oe},{name:"Attachments",label:__("Attachments"),icon:ee},{name:"WhatsApp",label:__("WhatsApp"),icon:Pe,condition:()=>Xe.value}].filter(t=>t.condition?t.condition():!0)),{tabIndex:b,changeTabTo:he}=Re(R,"lastLeadTab");ya(R,a=>{if(a&&y.params.tabName){let t=a.findIndex(n=>n.name.toLowerCase()===y.params.tabName.toLowerCase());t!==-1&&(b.value=t)}});const z=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});function F(a,t,n){ge(a,t,()=>{s.data[a]=t,n==null||n()})}async function Ce(a){await K("frappe.client.delete",{doctype:"CRM Lead",name:a}),T.push({name:"Leads"})}const h=v(!1),M=v(!1),L=v(!1),C=v(""),x=v(""),{triggerConvertToDeal:G,triggerOnChange:xe,assignees:Q,document:w}=ua("CRM Lead",V.leadId);async function we(){if(M.value&&!C.value){f.error(__("Please select an existing contact"));return}if(L.value&&!x.value){f.error(__("Please select an existing organization"));return}!M.value&&C.value&&(C.value=""),!L.value&&x.value&&(x.value=""),await(G==null?void 0:G(s.data,k,()=>h.value=!1));let a=await K("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:s.data.name,deal:k,existing_contact:C.value,existing_organization:x.value}).catch(t=>{var n;f.error(__("Error converting to deal: {0}",[(n=t.messages)==null?void 0:n[0]]))});a&&(h.value=!1,M.value=!1,L.value=!1,C.value="",x.value="",ve("convert_lead_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+re,a)}),wa("convert_lead_to_deal"),T.push({name:"Deal",params:{dealId:a}}))}const q=v(null);function ke(){let a=R.value[b.value];["Emails","Comments","Activities"].includes(a.name)||q.value.changeTabTo("emails"),La(()=>q.value.emailBox.show=!0)}const k=ba({}),Ie=O(()=>{let a=Y("deal");return k.status||(k.status=a[0].value),a}),H=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:a=>{let t=!1,n=a==null?void 0:a.forEach(c=>{var I;(I=c.sections)==null||I.forEach(J=>{var A;(A=J.columns)==null||A.forEach(N=>{var o;(o=N.fields)==null||o.forEach(u=>{t=!0,u.fieldname=="status"&&(u.fieldtype="Select",u.options=Ie.value,u.prefix=_e(k.status).color),u.fieldtype==="Table"&&(k[u.fieldname]=[])})})})});return t?n:[]}});function Me(){ma.value=!0,pa.value={doctype:"CRM Deal",onlyRequired:!0},h.value=!1}function Z(a){a!=null&&a.hasOwnProperty("lead_owner")&&Q.reload()}return(a,t)=>{var A,N;const n=P("FeatherIcon"),c=P("Button"),I=P("ErrorMessage"),J=P("Dialog");return d(),E(ha,null,[e(s).data?(d(),p(Ye,{key:0},{"left-header":r(()=>[l(e(Va),{items:be.value},{prefix:r(({item:o})=>[o.icon?(d(),p(Ve,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):_("",!0)]),_:1},8,["items"])]),"right-header":r(()=>{var o,u;return[(o=e(s).data._customActions)!=null&&o.length?(d(),p(se,{key:0,actions:e(s).data._customActions},null,8,["actions"])):_("",!0),(u=e(w).actions)!=null&&u.length?(d(),p(se,{key:1,actions:e(w).actions},null,8,["actions"])):_("",!0),l(Se,{modelValue:e(Q).data,"onUpdate:modelValue":t[0]||(t[0]=m=>e(Q).data=m),data:e(w).doc,doctype:"CRM Lead"},null,8,["modelValue","data"]),e(w).doc?(d(),p(e(oe),{key:2,options:e(Y)("lead",e(w),e(s).data._customStatuses,e(xe))},{default:r(({open:m})=>[l(c,{label:e(w).doc.status},{prefix:r(()=>[l(Be,{class:ka(e(pe)(e(w).doc.status).color)},null,8,["class"])]),suffix:r(()=>[l(n,{name:m?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])):_("",!0),l(c,{label:a.__("Convert to Deal"),variant:"solid",onClick:t[1]||(t[1]=m=>h.value=!0)},null,8,["label"])]}),_:1})):_("",!0),(A=e(s))!=null&&A.data?(d(),E("div",Sa,[l(e(ca),{as:"div",modelValue:e(b),"onUpdate:modelValue":t[5]||(t[5]=o=>X(b)?b.value=o:null),tabs:R.value},{"tab-panel":r(()=>[l(Te,{ref_key:"activities",ref:q,doctype:"CRM Lead",tabs:R.value,reload:j.value,"onUpdate:reload":t[2]||(t[2]=o=>j.value=o),tabIndex:e(b),"onUpdate:tabIndex":t[3]||(t[3]=o=>X(b)?b.value=o:null),modelValue:e(s),"onUpdate:modelValue":t[4]||(t[4]=o=>X(s)?s.value=o:null),onAfterSave:Z},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(Le,{class:"flex flex-col justify-between border-l",side:"right"},{default:r(()=>[i("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9",onClick:t[6]||(t[6]=o=>e(na)(e(s).data.name))},g(a.__(e(s).data.name)),1),l(e(Ra),{onSuccess:t[8]||(t[8]=o=>F("image",o.file_url)),validateFile:e(ia)},{default:r(({openFileSelector:o,error:u})=>[i("div",Ta,[i("div",$a,[l(e(ra),{size:"3xl",class:"size-12",label:D.value,image:e(s).data.image},null,8,["label","image"]),(d(),p(Ma(e(s).data.image?e(oe):"div"),Ia(e(s).data.image?{options:[{icon:"upload",label:e(s).data.image?a.__("Change image"):a.__("Upload image"),onClick:o},{icon:"trash-2",label:a.__("Remove image"),onClick:()=>F("image","")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:r(()=>[i("div",Da,[l(je,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),i("div",za,[l(e(S),{text:e(s).data.lead_name||a.__("Set first name")},{default:r(()=>[i("div",Fa,g(D.value),1)]),_:1},8,["text"]),i("div",qa,[e(He)?(d(),p(e(S),{key:0,text:a.__("Make a call")},{default:r(()=>[i("div",null,[l(c,{class:"h-7 w-7",onClick:()=>e(s).data.mobile_no?e(me)(e(s).data.mobile_no):e(f).error(a.__("No phone number set"))},{icon:r(()=>[l(ae)]),_:2},1032,["onClick"])])]),_:2},1032,["text"])):_("",!0),l(e(S),{text:a.__("Send an email")},{default:r(()=>[i("div",null,[l(c,{class:"h-7 w-7",onClick:m=>e(s).data.email?ke():e(f).error(a.__("No email set"))},{icon:r(()=>[l(Fe)]),_:2},1032,["onClick"])])]),_:2},1032,["text"]),l(e(S),{text:a.__("Go to website")},{default:r(()=>[i("div",null,[l(c,{class:"h-7 w-7",onClick:m=>e(s).data.website?e(da)(e(s).data.website):e(f).error(a.__("No website set"))},{icon:r(()=>[l(We)]),_:2},1032,["onClick"])])]),_:2},1032,["text"]),l(e(S),{text:a.__("Attach a file")},{default:r(()=>[i("div",null,[l(c,{class:"h-7 w-7",onClick:t[7]||(t[7]=m=>W.value=!0)},{icon:r(()=>[l(ee)]),_:1})])]),_:1},8,["text"])]),l(I,{message:a.__(u)},null,8,["message"])])])]),_:1},8,["validateFile"]),e(s).data.sla_status?(d(),p($e,{key:0,modelValue:e(s).data,"onUpdate:modelValue":t[9]||(t[9]=o=>e(s).data=o),onUpdateField:F},null,8,["modelValue"])):_("",!0),e(z).data?(d(),E("div",Na,[l(Ze,{sections:e(z).data,doctype:"CRM Lead",docname:e(s).data.name,onReload:e(z).reload,onAfterFieldChange:Z},null,8,["sections","docname","onReload"])])):_("",!0)]),_:1})])):$.value?(d(),p(Ee,{key:2,errorTitle:$.value,errorMessage:B.value},null,8,["errorTitle","errorMessage"])):_("",!0),l(J,{modelValue:h.value,"onUpdate:modelValue":t[15]||(t[15]=o=>h.value=o),options:{size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:we}]}},{"body-header":r(()=>[i("div",Ua,[i("div",null,[i("h3",Oa,g(a.__("Convert to Deal")),1)]),i("div",Pa,[e(de)()&&!e(Je)?(d(),p(c,{key:0,variant:"ghost",class:"w-7",onClick:Me},{icon:r(()=>[l(Ke,{class:"h-4 w-4"})]),_:1})):_("",!0),l(c,{variant:"ghost",class:"w-7",onClick:t[10]||(t[10]=o=>h.value=!1)},{icon:r(()=>[l(n,{name:"x",class:"h-4 w-4"})]),_:1})])])]),"body-content":r(()=>{var o,u;return[i("div",Ba,[l(Ge,{class:"h-4 w-4"}),i("label",ja,g(a.__("Organization")),1)]),i("div",Wa,[i("div",Ga,[i("div",null,g(a.__("Choose Existing")),1),l(e(le),{modelValue:L.value,"onUpdate:modelValue":t[11]||(t[11]=m=>L.value=m)},null,8,["modelValue"])]),L.value?(d(),p(te,{key:0,class:"form-control mt-2.5",size:"md",value:x.value,doctype:"CRM Organization",onChange:t[12]||(t[12]=m=>x.value=m)},null,8,["value"])):(d(),E("div",Qa,g(a.__("New organization will be created based on the data in details section")),1))]),i("div",Ha,[l(Qe,{class:"h-4 w-4"}),i("label",Ja,g(a.__("Contact")),1)]),i("div",Ka,[i("div",Xa,[i("div",null,g(a.__("Choose Existing")),1),l(e(le),{modelValue:M.value,"onUpdate:modelValue":t[13]||(t[13]=m=>M.value=m)},null,8,["modelValue"])]),M.value?(d(),p(te,{key:0,class:"form-control mt-2.5",size:"md",value:C.value,doctype:"Contact",onChange:t[14]||(t[14]=m=>C.value=m)},null,8,["value"])):(d(),E("div",Ya,g(a.__("New contact will be created based on the person's details")),1))]),(o=e(H).data)!=null&&o.length?(d(),E("div",Za)):_("",!0),(u=e(H).data)!=null&&u.length?(d(),p(aa,{key:1,tabs:e(H).data,data:k,doctype:"CRM Deal"},null,8,["tabs","data"])):_("",!0)]}),_:1},8,["modelValue","options"]),(N=e(s).data)!=null&&N.name?(d(),p(Ae,{key:3,modelValue:W.value,"onUpdate:modelValue":t[16]||(t[16]=o=>W.value=o),doctype:"CRM Lead",docname:e(s).data.name,onAfter:t[17]||(t[17]=()=>{var o,u;(u=(o=q.value)==null?void 0:o.all_activities)==null||u.reload(),e(he)("attachments")})},null,8,["modelValue","docname"])):_("",!0)],64)}}};export{Bt as default};
//# sourceMappingURL=Lead-de7b5a0d.js.map
