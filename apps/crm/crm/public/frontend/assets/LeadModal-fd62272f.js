import{i as F,E as D}from"./DragVerticalIcon-56a1fcba.js";import{F as Q}from"./FieldLayout-9051362d.js";import{u as q}from"./index-1be1092b.js";import{s as z}from"./statuses-2b43883f.js";import{m as P,s as T,i as U,B as A,l as M,j as J,z as k,a as W,e as i,f as d,g as m,w as v,d as n,t as $,u,b as f,p as g,J as G,I as H}from"./index-77a1adb3.js";import{u as K,c as X,q as Y}from"./modals-6b779b18.js";import{u as Z}from"./helpCenter-caf03f7d.js";const ee={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},ae={class:"mb-5 flex items-center justify-between"},se={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},te={class:"flex items-center gap-1"},oe={class:"px-4 pb-7 pt-4 sm:px-6"},le={class:"flex flex-row-reverse gap-2"},fe={__name:"LeadModal",props:P({defaults:Object},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const w=b,{user:x}=T(),{getUser:C,isManager:E}=q(),{getLeadStatus:L,statusOptions:S}=z(),{updateOnboardingStep:N}=Z("frappecrm"),r=U(b,"modelValue"),V=A(),s=M(null),c=M(!1),{document:e,triggerOnChange:R}=K("CRM Lead"),p=J(()=>{var t;let a=S("lead",null,[],R);return e.doc.status||(e.doc.status=(t=a==null?void 0:a[0])==null?void 0:t.value),a}),y=k({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Lead"],params:{doctype:"CRM Lead",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(_=>{_.fields.forEach(l=>{l.fieldname=="status"&&(l.fieldtype="Select",l.options=p.value,l.prefix=L(e.doc.status).color),l.fieldtype==="Table"&&(e.doc[l.fieldname]=[])})})})})}),I=k({url:"frappe.client.insert",makeParams(a){return{doc:{doctype:"CRM Lead",...a}}}});function B(){e.doc.website&&!e.doc.website.startsWith("http")&&(e.doc.website="https://"+e.doc.website),I.submit(e.doc,{validate(){if(s.value=null,!e.doc.first_name)return s.value=__("First Name is mandatory"),s.value;if(e.doc.annual_revenue){if(typeof e.doc.annual_revenue=="string")e.doc.annual_revenue=e.doc.annual_revenue.replace(/,/g,"");else if(isNaN(e.doc.annual_revenue))return s.value=__("Annual Revenue should be a number"),s.value}if(e.doc.mobile_no&&isNaN(e.doc.mobile_no.replace(/[-+() ]/g,"")))return s.value=__("Mobile No should be a number"),s.value;if(e.doc.email&&!e.doc.email.includes("@"))return s.value=__("Invalid Email"),s.value;if(!e.doc.status)return s.value=__("Status is required"),s.value;c.value=!0},onSuccess(a){G("lead_created"),c.value=!1,r.value=!1,V.push({name:"Lead",params:{leadId:a.name}}),N("create_first_lead",!0,!1,()=>{localStorage.setItem("firstLead"+x,a.name)})},onError(a){if(c.value=!1,!a.messages){s.value=a.message;return}s.value=a.messages.join(`
`)}})}function O(){X.value=!0,Y.value={doctype:"CRM Lead"},H(()=>r.value=!1)}return W(()=>{var a,t,o;e.doc={no_of_employees:"1-10"},Object.assign(e.doc,w.defaults),(a=e.doc)!=null&&a.lead_owner||(e.doc.lead_owner=C().name),!((t=e.doc)!=null&&t.status)&&((o=p.value[0])!=null&&o.value)&&(e.doc.status=p.value[0].value)}),(a,t)=>{const o=i("Button"),_=i("FeatherIcon"),l=i("ErrorMessage"),j=i("Dialog");return d(),m(j,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=h=>r.value=h),options:{size:"3xl"}},{body:v(()=>[n("div",ee,[n("div",ae,[n("div",null,[n("h3",se,$(a.__("Create Lead")),1)]),n("div",te,[u(E)()&&!u(F)?(d(),m(o,{key:0,variant:"ghost",class:"w-7",onClick:O},{icon:v(()=>[f(D)]),_:1})):g("",!0),f(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=h=>r.value=!1)},{icon:v(()=>[f(_,{name:"x",class:"size-4"})]),_:1})])]),n("div",null,[u(y).data?(d(),m(Q,{key:0,tabs:u(y).data,data:u(e).doc},null,8,["tabs","data"])):g("",!0),s.value?(d(),m(l,{key:1,class:"mt-4",message:a.__(s.value)},null,8,["message"])):g("",!0)])]),n("div",oe,[n("div",le,[f(o,{variant:"solid",label:a.__("Create"),loading:c.value,onClick:B},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}};export{fe as _};
//# sourceMappingURL=LeadModal-fd62272f.js.map
