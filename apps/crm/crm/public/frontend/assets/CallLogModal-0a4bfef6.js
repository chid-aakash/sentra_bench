import{i as se,E as ne}from"./DragVerticalIcon-56a1fcba.js";import{A as me}from"./ArrowUpRightIcon-8e3aac11.js";import{K as G,f as s,c as u,d as o,B as _e,i as Q,l as w,j as ie,k as pe,e as U,b as c,w as b,t as V,u as m,g as $,p as L,a3 as z,F as K,r as re,C as ve,D as ge,_ as fe,n as q,x as X,E as J,I as ce,m as Ce,z as Y,J as ye,a as he,a7 as ke,ap as be,y as Le}from"./index-77a1adb3.js";import{C as Me}from"./ContactsIcon-4e391f66.js";import{L as xe}from"./LeadsIcon-788f061a.js";import{D as we}from"./DealsIcon-b1eef88d.js";import{C as De}from"./CalendarIcon-f8132aad.js";import{N as ee,_ as Ie}from"./NoteModal-ef63f4f5.js";import{T as ae}from"./TaskIcon-95e40b66.js";import{T as $e}from"./TaskModal-f9c99550.js";import{a as le}from"./FadedScrollableDiv-3bd2f113.js";import{b as Ve,f as te,t as Te,u as ue,a as oe,n as Ee}from"./index-1be1092b.js";import{u as de,c as Be,q as Ne}from"./modals-6b779b18.js";import{_ as Re}from"./Dropdown.vue_vue_type_script_setup_true_lang-20f66514.js";import{F as Fe}from"./FieldLayout-9051362d.js";const Ae={},Pe={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ze(n,l){return s(),u("svg",Pe,l[0]||(l[0]=[o("g",{"clip-path":"url(#clip0_4750_5685)"},[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.4375 6C10.4375 8.45076 8.45076 10.4375 6 10.4375C3.54924 10.4375 1.5625 8.45076 1.5625 6C1.5625 3.54924 3.54924 1.5625 6 1.5625C8.45076 1.5625 10.4375 3.54924 10.4375 6ZM11.4375 6C11.4375 9.00305 9.00305 11.4375 6 11.4375C2.99695 11.4375 0.5625 9.00305 0.5625 6C0.5625 2.99695 2.99695 0.5625 6 0.5625C9.00305 0.5625 11.4375 2.99695 11.4375 6ZM9.00005 5.50004C9.27619 5.50004 9.50004 5.72391 9.50004 6.00005C9.50004 6.27619 9.27618 6.50004 9.00003 6.50004L6.25001 6.5C5.8358 6.49999 5.50003 6.16421 5.50002 5.75L5.5 3C5.5 2.72386 5.72385 2.5 6 2.5C6.27614 2.5 6.5 2.72385 6.5 3L6.50002 5.5L9.00005 5.50004Z",fill:"currentColor"})],-1),o("defs",null,[o("clipPath",{id:"clip0_4750_5685"},[o("rect",{width:"12",height:"12",fill:"white"})])],-1)]))}const He=G(Ae,[["render",ze]]),Se={},Oe={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Qe(n,l){return s(),u("svg",Oe,l[0]||(l[0]=[o("g",{"clip-path":"url(#clip0_3668_69185)"},[o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),o("defs",null,[o("clipPath",{id:"clip0_3668_69185"},[o("rect",{width:"16",height:"16",fill:"white"})])],-1)]))}const Ue=G(Se,[["render",Qe]]),{getFormattedPercent:je,getFormattedFloat:Ze,getFormattedCurrency:qe}=Ve("CRM Call Log");function Je(n,l,M=[]){var h,d,p,f,I;let g=l.type==="Incoming";if(n==="duration")return{label:l._duration,icon:"clock"};if(n==="caller")return{label:(h=l._caller)==null?void 0:h.label,image:(d=l._caller)==null?void 0:d.image};if(n==="receiver")return{label:(p=l._receiver)==null?void 0:p.label,image:(f=l._receiver)==null?void 0:f.image};if(n==="type")return{label:l.type,icon:g?"phone-incoming":"phone-outgoing"};if(n==="status")return{label:Ke[l.status],color:Ge[l.status]};if(["modified","creation"].includes(n))return{label:te(l[n]),timeAgo:__(Te(l[n]))};let r=(I=M==null?void 0:M.find(D=>(D.key||D.value)==n))==null?void 0:I.type;return r&&["Date","Datetime"].includes(r)?te(l[n],"",!0,r=="Datetime"):r&&r=="Currency"?qe(n,l):r&&r=="Float"?Ze(n,l):r&&r=="Percent"?je(n,l):l[n]}const Ke={Completed:"Completed",Initiated:"Initiated",Busy:"Declined",Failed:"Failed",Queued:"Queued",Canceled:"Canceled",Ringing:"Ringing","No Answer":"Missed Call","In Progress":"In Progress"},Ge={Completed:"green",Busy:"orange",Failed:"red",Initiated:"gray",Queued:"gray",Canceled:"gray",Ringing:"gray","No Answer":"red","In Progress":"blue"};const We={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Xe={class:"mb-5 flex items-center justify-between"},Ye={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ea={class:"flex items-center gap-1"},aa={class:"flex flex-col gap-3.5"},la={class:"grid size-7 place-content-center"},ta={class:"flex min-h-7 w-full items-center gap-2"},oa={key:0,class:"flex items-center gap-1"},sa={class:"ml-1 flex flex-col gap-1"},na={class:"ml-1 flex flex-col gap-1"},ia={key:2,class:"w-full"},ra=["src"],ca=["innerHTML"],ua=["innerHTML"],da=["innerHTML"],ma=["innerHTML"],_a={key:6},pa={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},va={__name:"CallLogDetailModal",props:{modelValue:{},modelModifiers:{},callLog:{},callLogModifiers:{},callLogModal:{},callLogModalModifiers:{}},emits:["update:modelValue","update:callLog","update:callLogModal"],setup(n){const{isManager:l}=ue(),M=_e(),g=Q(n,"modelValue"),r=w(!1),h=w(!1),d=Q(n,"callLog"),p=w({title:"",content:""}),f=w({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),I=ie(()=>{var _,y,v,T,E,B;if(!((_=d.value)!=null&&_.data))return[];let e=JSON.parse(JSON.stringify((y=d.value)==null?void 0:y.data));for(const k in e)e[k]=Je(k,e);return p.value=((v=e._notes)==null?void 0:v[0])??null,f.value=((T=e._tasks)==null?void 0:T[0])??null,[{icon:X(z,{name:e.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:e.type.label+" Call"},{icon:Me,name:"receiver",value:{receiver:e.receiver,caller:e.caller}},{icon:e._lead?xe:we,name:"reference_doc",value:e._lead?"Lead":"Deal",link:()=>{e._lead?M.push({name:"Lead",params:{leadId:e._lead}}):M.push({name:"Deal",params:{dealId:e._deal}})},condition:()=>e._lead||e._deal},{icon:De,name:"creation",value:e.creation.label,tooltip:e.creation.label},{icon:He,name:"duration",value:e.duration.label},{icon:Ue,name:"status",value:e.status.label,color:e.status.color},{icon:X(z,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:e.recording_url},{icon:ee,name:"note",value:((E=e._notes)==null?void 0:E[0])??null},{icon:ae,name:"task",value:((B=e._tasks)==null?void 0:B[0])??null}].filter(k=>k.value).filter(k=>k.condition?k.condition():!0)}),D=w({}),H=w({});async function j(){var e,t,_,y;await((_=(t=D.value).triggerOnCreateLead)==null?void 0:_.call(t,(e=d.value)==null?void 0:e.data,H.value,()=>g.value=!1)),J("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:(y=d.value)==null?void 0:y.data,lead_details:H.value}).then(v=>{v&&M.push({name:"Lead",params:{leadId:v}})})}const S=Q(n,"callLogModal");function Z(){S.value=!0,ce(()=>{g.value=!1})}function O(){var e;(e=p.value)!=null&&e.name||(p.value={title:"",content:""}),r.value=!0}function i(){var e;(e=f.value)!=null&&e.name||(f.value={title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),h.value=!0}async function C(e,t=!1){var _,y;p.value=e,t&&e.name&&await J("crm.integrations.api.add_note_to_call_log",{call_sid:(y=(_=d.value)==null?void 0:_.data)==null?void 0:y.id,note:e})}async function x(e,t=!1){var _,y;f.value=e,t&&e.name&&await J("crm.integrations.api.add_task_to_call_log",{call_sid:(y=(_=d.value)==null?void 0:_.data)==null?void 0:y.id,task:e})}return pe(()=>{var e,t;return(t=(e=d.value)==null?void 0:e.data)==null?void 0:t.name},e=>{e&&(D.value=de("CRM Call Log",e))}),(e,t)=>{const _=U("Button"),y=U("Dialog");return s(),u(K,null,[c(y,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=v=>g.value=v)},{body:b(()=>{var v,T,E,B,k,W;return[o("div",We,[o("div",Xe,[o("div",null,[o("h3",Ye,V(e.__("Call Details")),1)]),o("div",ea,[c(m(Re),{options:[{group:e.__("Options"),hideLabel:!0,items:[{label:(v=p.value)!=null&&v.name?e.__("Edit note"):e.__("Add note"),icon:ee,onClick:O},{label:(T=f.value)!=null&&T.name?e.__("Edit task"):e.__("Add task"),icon:ae,onClick:i}]}]},{default:b(()=>[c(_,{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"]),m(l)()&&!m(se)?(s(),$(_,{key:0,variant:"ghost",class:"w-7",onClick:Z},{icon:b(()=>[c(ne)]),_:1})):L("",!0),c(_,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=a=>g.value=!1)},{icon:b(()=>[c(m(z),{name:"x",class:"size-4"})]),_:1})])]),o("div",aa,[(s(!0),u(K,null,re(I.value,a=>(s(),u("div",{key:a.name,class:"flex gap-2 text-base text-ink-gray-8"},[o("div",la,[(s(),$(ve(a.icon)))]),o("div",ta,[a.name=="receiver"?(s(),u("div",oa,[c(m(oe),{image:a.value.caller.image,label:a.value.caller.label,size:"sm"},null,8,["image","label"]),o("div",sa,V(a.value.caller.label),1),c(m(z),{name:"arrow-right",class:"mx-1 h-4 w-4 text-ink-gray-5"}),c(m(oe),{image:a.value.receiver.image,label:a.value.receiver.label,size:"sm"},null,8,["image","label"]),o("div",na,V(a.value.receiver.label),1)])):a.tooltip?(s(),$(m(fe),{key:1,text:a.tooltip},{default:b(()=>[ge(V(a.value),1)]),_:2},1032,["text"])):a.name=="recording_url"?(s(),u("div",ia,[o("audio",{class:"audio-control w-full",controls:"",src:a.value},null,8,ra)])):a.name=="note"?(s(),u("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:t[1]||(t[1]=()=>r.value=!0)},[c(le,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:b(()=>{var N,R,F,A,P;return[(N=a.value)!=null&&N.title?(s(),u("div",{key:0,class:q([(R=a.value)!=null&&R.content?"mb-1 font-bold":""]),innerHTML:(F=a.value)==null?void 0:F.title},null,10,ca)):L("",!0),(A=a.value)!=null&&A.content?(s(),u("div",{key:1,innerHTML:(P=a.value)==null?void 0:P.content},null,8,ua)):L("",!0)]}),_:2},1024)])):a.name=="task"?(s(),u("div",{key:4,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:t[2]||(t[2]=()=>h.value=!0)},[c(le,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:b(()=>{var N,R,F,A,P;return[(N=a.value)!=null&&N.title?(s(),u("div",{key:0,class:q([(R=a.value)!=null&&R.description?"mb-1 font-bold":""]),innerHTML:(F=a.value)==null?void 0:F.title},null,10,da)):L("",!0),(A=a.value)!=null&&A.description?(s(),u("div",{key:1,innerHTML:(P=a.value)==null?void 0:P.description},null,8,ma)):L("",!0)]}),_:2},1024)])):(s(),u("div",{key:5,class:q(a.color?`text-${a.color}-600`:"")},V(a.value),3)),a.link?(s(),u("div",_a,[c(me,{class:"h-4 w-4 shrink-0 cursor-pointer text-ink-gray-5 hover:text-ink-gray-8",onClick:()=>a.link()},null,8,["onClick"])])):L("",!0)])]))),128))])]),!((B=(E=d.value)==null?void 0:E.data)!=null&&B._lead)&&!((W=(k=d.value)==null?void 0:k.data)!=null&&W._deal)?(s(),u("div",pa,[c(_,{class:"w-full",variant:"solid",label:e.__("Create lead"),onClick:j},null,8,["label"])])):L("",!0)]}),_:1},8,["modelValue"]),c(Ie,{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=v=>r.value=v),note:p.value,onAfter:C},null,8,["modelValue","note"]),c($e,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=v=>h.value=v),task:f.value,onAfter:x},null,8,["modelValue","task"])],64)}}},za=G(va,[["__scopeId","data-v-376ff28b"]]),ga={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},fa={class:"flex items-center justify-between mb-5"},Ca={class:"flex items-center gap-2"},ya={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ha={class:"flex items-center gap-1"},ka={key:0},ba={class:"px-4 pt-4 pb-7 sm:px-6"},La={class:"space-y-2"},Ha={__name:"CallLogModal",props:Ce({data:{type:Object,default:()=>({})},options:{type:Object,default:{afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){var O;const l=n,{isManager:M}=ue(),g=Q(n,"modelValue"),r=w(!1),h=w(null),d=w(!1),{document:p}=de("CRM Call Log",((O=l.data)==null?void 0:O.name)||""),f=ie(()=>{let i=d.value?__("Edit Call Log"):__("New Call Log"),C="xl",x=[{label:d.value?__("Save"):__("Create"),variant:"solid",onClick:()=>d.value?H():j.submit()}];return{title:i,size:C,actions:x}}),I=Y({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Call Log"],params:{doctype:"CRM Call Log",type:"Quick Entry"},auto:!0}),D={onSuccess:i=>{r.value=!1,S(i)},onError:i=>{if(r.value=!1,i.exc_type=="MandatoryError"){const C=i.messages.map(x=>x.split(": ")[2].trim()).join(", ");h.value=__("These fields are required: {0}",[C]);return}h.value=i}};async function H(){r.value=!0,await p.save.submit(null,D)}const j=Y({url:"frappe.client.insert",makeParams(){return{doc:{doctype:"CRM Call Log",id:Ee(6),telephony_medium:"Manual",...p.doc}}},onSuccess(i){r.value=!1,i.name&&(ye("call_log_created"),S(i))},onError(i){D.onError(i)}});function S(i){g.value=!1,l.options.afterInsert&&l.options.afterInsert(i)}he(()=>{var i,C;d.value=!!((i=l.data)!=null&&i.name),(C=l.data)!=null&&C.name||(p.doc={...l.data})});function Z(){Be.value=!0,Ne.value={doctype:"CRM Call Log"},ce(()=>g.value=!1)}return(i,C)=>{const x=U("Button"),e=U("Dialog");return s(),$(e,{modelValue:g.value,"onUpdate:modelValue":C[1]||(C[1]=t=>g.value=t),options:f.value},{body:b(()=>[o("div",ga,[o("div",fa,[o("div",Ca,[o("h3",ya,V(i.__(f.value.title)||i.__("Untitled")),1),m(p).isDirty?(s(),$(m(ke),{key:0,label:"Not Saved",theme:"orange"})):L("",!0)]),o("div",ha,[m(M)()&&!m(se)?(s(),$(x,{key:0,variant:"ghost",class:"w-7",onClick:Z},{icon:b(()=>[c(ne)]),_:1})):L("",!0),c(x,{variant:"ghost",class:"w-7",onClick:C[0]||(C[0]=t=>g.value=!1)},{icon:b(()=>[c(m(z),{name:"x",class:"size-4"})]),_:1})])]),m(I).data?(s(),u("div",ka,[c(Fe,{tabs:m(I).data,data:m(p).doc,doctype:"CRM Call Log"},null,8,["tabs","data"]),c(m(be),{class:"mt-8",message:h.value},null,8,["message"])])):L("",!0)]),o("div",ba,[o("div",La,[(s(!0),u(K,null,re(f.value.actions,t=>(s(),$(x,Le({class:"w-full",key:t.label,ref_for:!0},t,{label:i.__(t.label),loading:r.value}),null,16,["label","loading"]))),128))])])]),_:1},8,["modelValue","options"])}}};export{za as C,He as D,Ha as _,Ge as a,Je as g,Ke as s};
//# sourceMappingURL=CallLogModal-0a4bfef6.js.map
