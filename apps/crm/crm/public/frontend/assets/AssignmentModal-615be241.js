import{m as b,i as h,l as C,j as F,a as J,e as p,f as u,g as f,w as l,b as d,u as _,_ as M,d as y,t as U,c as j,F as O,r as I,q as L,p as V,E as k,J as w}from"./index-77a1adb3.js";import{u as q,_ as x}from"./index-1be1092b.js";import{_ as R}from"./DragVerticalIcon-56a1fcba.js";const T={class:"cursor-pointer text-ink-gray-9"},G={class:"mt-3 flex flex-wrap items-center gap-2"},W={__name:"AssignmentModal",props:b({doc:{type:Object,default:null},docs:{type:Set,default:new Set},doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{},assignees:{},assigneesModifiers:{}}),emits:b(["reload"],["update:modelValue","update:assignees"]),setup(g,{emit:A}){const t=g,S=A,m=h(g,"modelValue"),n=h(g,"assignees"),r=C([]),v=C(""),{getUser:c}=q(),B=e=>{n.value=n.value.filter(s=>s.name!==e)},N=F(()=>t.doc?t.doctype=="CRM Lead"?t.doc.lead_owner:t.doc.deal_owner:""),$=e=>{v.value="";let s={name:e,image:c(e).user_image,label:c(e).full_name};n.value.find(o=>o.name===e)||n.value.push(s)};function z(){const e=r.value.filter(o=>!n.value.find(i=>i.name===o.name)).map(o=>o.name),s=n.value.filter(o=>!r.value.find(i=>i.name===o.name)).map(o=>o.name);e.length&&k("crm.api.doc.remove_assignments",{doctype:t.doctype,name:t.doc.name,assignees:JSON.stringify(e)}),s.length&&(t.docs.size?(w("bulk_assign_to",{doctype:t.doctype}),k("frappe.desk.form.assign_to.add_multiple",{doctype:t.doctype,name:JSON.stringify(Array.from(t.docs)),assign_to:s,bulk_assign:!0,re_assign:!0}).then(()=>{S("reload")})):(w("assign_to",{doctype:t.doctype}),k("frappe.desk.form.assign_to.add",{doctype:t.doctype,name:t.doc.name,assign_to:s}))),m.value=!1}return J(()=>{r.value=[...n.value]}),(e,s)=>{const o=p("FeatherIcon"),i=p("Button"),D=p("ErrorMessage"),E=p("Dialog");return u(),f(E,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=a=>m.value=a),options:{title:e.__("Assign To"),size:"xl",actions:[{label:e.__("Cancel"),variant:"subtle",onClick:()=>{n.value=[...r.value],m.value=!1}},{label:e.__("Update"),variant:"solid",onClick:()=>z()}]},onClose:s[2]||(s[2]=()=>{n.value=[...r.value]})},{"body-content":l(()=>[d(R,{class:"form-control",value:"",doctype:"User",onChange:s[0]||(s[0]=a=>$(a)&&(e.$refs.input.value="")),placeholder:e.__("John Doe"),hideMe:!0},{"item-prefix":l(({option:a})=>[d(x,{class:"mr-2",user:a.value,size:"sm"},null,8,["user"])]),"item-label":l(({option:a})=>[d(_(M),{text:a.value},{default:l(()=>[y("div",T,U(_(c)(a.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder"]),y("div",G,[(u(!0),j(O,null,I(n.value,a=>(u(),f(_(M),{text:a.name,key:a.name},{default:l(()=>[y("div",null,[d(i,{label:_(c)(a.name).full_name,theme:"gray"},{prefix:l(()=>[d(x,{user:a.name,size:"sm"},null,8,["user"])]),suffix:l(()=>[a.name!==N.value?(u(),f(o,{key:0,class:"h-3.5",name:"x",onClick:L(H=>B(a.name),["stop"])},null,8,["onClick"])):V("",!0)]),_:2},1032,["label"])])]),_:2},1032,["text"]))),128))]),v.value?(u(),f(D,{key:0,class:"mt-2",message:e.__(v.value)},null,8,["message"])):V("",!0)]),_:1},8,["modelValue","options"])}}};export{W as _};
//# sourceMappingURL=AssignmentModal-615be241.js.map
