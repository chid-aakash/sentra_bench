import{m as ie,h as ce,i as ue,j as ee,s as Ce,k as we,l as w,e as S,f as a,c as u,b as i,w as v,u as _,F as te,r as xe,g as y,n as P,p,_ as se,d as L,t as h,q as pe,v as he,x as G}from"./index-77a1adb3.js";import{_ as Ve,a as Le}from"./ViewControls-0243c1de.js";import{_ as fe}from"./MultipleAvatar-812974f4.js";import{_ as $e}from"./CustomActions-cc223af8.js";import{E as Me}from"./EmailAtIcon-433e8e29.js";import{P as le}from"./PhoneIcon-cf282ece.js";import{_ as ze,N as re}from"./NoteModal-ef63f4f5.js";import{T as de}from"./TaskIcon-95e40b66.js";import{C as Ue}from"./CommentIcon-aa645985.js";import{I as Q}from"./IndicatorIcon-81343f13.js";import{L as Ae}from"./LeadsIcon-788f061a.js";import{_ as Te}from"./LayoutHeader-bf851e4e.js";import{_ as Re,H as _e,a as Be,b as Ie,c as De,d as Pe,e as Se,f as Ee}from"./ListRows-f93bf621.js";import{a as U,b as qe,g as We,u as je,f as F,w as Ke,t as N,c as Oe}from"./index-1be1092b.js";import{_ as me}from"./Dropdown.vue_vue_type_script_setup_true_lang-20f66514.js";import{_ as He}from"./ListFooter-88c0e00f.js";import{_ as Je}from"./KanbanView-5dcce96f.js";import{_ as Ge}from"./LeadModal-fd62272f.js";import{T as Fe}from"./TaskModal-f9c99550.js";import{s as Qe}from"./statuses-2b43883f.js";import{c as Xe}from"./DragVerticalIcon-56a1fcba.js";import"./FadedScrollableDiv-3bd2f113.js";import"./IconPicker-32bf6d73.js";import"./Popover-23375de3.js";import"./PinIcon-9a9cf1df.js";import"./DetailsIcon-5fbd1b96.js";import"./settings-efea4d57.js";import"./ArrowUpRightIcon-8e3aac11.js";import"./helpCenter-caf03f7d.js";import"./AssignmentModal-615be241.js";import"./label-ea862e17.js";import"./FieldLayout-9051362d.js";import"./modals-6b779b18.js";const Ye={key:0,class:"flex items-center"},Ze={key:0},Ne={key:1},et={key:2},tt={key:3},st=["onClick"],lt={key:1},at={key:2,class:"truncate text-base"},ot={key:3},nt=["onClick"],it={__name:"LeadsListView",props:ie({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:ie(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(b,{expose:X,emit:Y}){const C=Y,K=ce(),$=ue(b,"modelValue"),B=ue(b,"list"),E=ee(()=>{var n,f;return!!((f=(n=B.value.params)==null?void 0:n.filters)!=null&&f._liked_by)}),{user:q}=Ce();function M(n){if(n)return JSON.parse(n).includes(q)}we($,(n,f)=>{n!==f&&C("updatePageCount",n)});const I=w(null);return X({customListActions:ee(()=>{var n;return(n=I.value)==null?void 0:n.customListActions})}),(n,f)=>{const A=S("Button"),W=S("Badge"),V=S("FormControl");return a(),u(te,null,[i(_(Se),{class:P(n.$attrs.class),columns:b.columns,rows:b.rows,options:{getRowRoute:s=>({name:"Lead",params:{leadId:s.name},query:{view:_(K).query.view,viewType:_(K).params.viewType}}),selectable:b.options.selectable,showTooltip:b.options.showTooltip,resizeColumn:b.options.resizeColumn},"row-key":"name","onUpdate:selections":f[2]||(f[2]=s=>C("selectionsChanged",s))},{default:v(()=>[i(_(Re),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:f[1]||(f[1]=s=>C("columnWidthUpdated"))},{default:v(()=>[(a(!0),u(te,null,xe(b.columns,s=>(a(),y(_(Be),{key:s.key,item:s,onColumnWidthUpdated:m=>C("columnWidthUpdated",s)},{default:v(()=>[s.key=="_liked_by"?(a(),y(A,{key:0,variant:"ghosted",class:P(["!h-4",E.value?"fill-red-500":"fill-white"]),onClick:f[0]||(f[0]=()=>C("applyLikeFilter"))},{default:v(()=>[i(_e,{class:"h-4 w-4"})]),_:1},8,["class"])):p("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),i(Ie,{rows:b.rows,doctype:"CRM Lead"},{default:v(({idx:s,column:m,item:c,row:Z})=>[m.key==="_assign"?(a(),u("div",Ye,[i(fe,{avatars:c,size:"sm",onClick:T=>C("applyFilter",{event:T,idx:s,column:m,item:c,firstColumn:b.columns[0]})},null,8,["avatars","onClick"])])):(a(),y(_(De),{key:1,item:c,align:m.align},{prefix:v(()=>[m.key==="status"?(a(),u("div",Ze,[i(Q,{class:P(c.color)},null,8,["class"])])):m.key==="lead_name"?(a(),u("div",Ne,[c.label?(a(),y(_(U),{key:0,class:"flex items-center",image:c.image,label:c.image_label,size:"sm"},null,8,["image","label"])):p("",!0)])):m.key==="lead_owner"?(a(),u("div",et,[c.full_name?(a(),y(_(U),{key:0,class:"flex items-center",image:c.user_image,label:c.full_name,size:"sm"},null,8,["image","label"])):p("",!0)])):m.key==="mobile_no"?(a(),u("div",tt,[i(le,{class:"h-4 w-4"})])):p("",!0)]),default:v(({label:T})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(m.key)?(a(),u("div",{key:0,class:"truncate text-base",onClick:R=>C("applyFilter",{event:R,idx:s,column:m,item:c,firstColumn:b.columns[0]})},[i(_(se),{text:c.label},{default:v(()=>[L("div",null,h(c.timeAgo),1)]),_:2},1032,["text"])],8,st)):m.key==="_liked_by"?(a(),u("div",lt,[m.key=="_liked_by"?(a(),y(A,{key:0,variant:"ghosted",class:P(M(c)?"fill-red-500":"fill-white"),onClick:pe(()=>C("likeDoc",{name:Z.name,liked:M(c)}),["stop","prevent"])},{default:v(()=>[i(_e,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):p("",!0)])):m.key==="sla_status"?(a(),u("div",at,[c.value?(a(),y(W,{key:0,variant:"subtle",theme:c.color,size:"md",label:c.value,onClick:R=>C("applyFilter",{event:R,idx:s,column:m,item:c,firstColumn:b.columns[0]})},null,8,["theme","label","onClick"])):p("",!0)])):m.type==="Check"?(a(),u("div",ot,[i(V,{type:"checkbox",modelValue:c,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):(a(),u("div",{key:4,class:"truncate text-base",onClick:R=>C("applyFilter",{event:R,idx:s,column:m,item:c,firstColumn:b.columns[0]})},h(T),9,nt))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),i(_(Pe),null,{actions:v(({selections:s,unselectAll:m})=>[i(_(me),{options:I.value.bulkActions(s,m)},{default:v(()=>[i(A,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),$.value?(a(),y(_(He),{key:0,class:"border-t sm:px-5 px-3 py-2",modelValue:$.value,"onUpdate:modelValue":f[3]||(f[3]=s=>$.value=s),options:{rowCount:b.options.rowCount,totalCount:b.options.totalCount},onLoadMore:f[4]||(f[4]=s=>C("loadMore"))},null,8,["modelValue","options"])):p("",!0),i(Ee,{ref_key:"listBulkActionsRef",ref:I,modelValue:B.value,"onUpdate:modelValue":f[5]||(f[5]=s=>B.value=s),doctype:"CRM Lead"},null,8,["modelValue"])],64)}}},ut={class:"flex items-center gap-2"},rt={key:0},dt={key:1},_t={key:2},ct={key:3},pt={key:4},ft={key:5,class:"truncate text-base"},mt={key:6,class:"truncate text-base"},vt={key:7,class:"truncate text-base"},kt={key:8,class:"text-ink-gray-4"},yt={key:0,class:"truncate flex items-center gap-2"},bt={key:0},gt={key:1},Ct={key:2},wt={key:3},xt={key:4,class:"truncate text-base"},ht={key:5,class:"truncate text-base"},Vt={key:6,class:"flex items-center"},Lt={key:7,class:"truncate text-base"},$t={class:"flex gap-2 items-center justify-between"},Mt={class:"text-ink-gray-5 flex items-center gap-1.5"},zt={key:0},Ut={key:1},At={key:2},Tt={key:3},Rt={key:2,class:"flex h-full items-center justify-center"},Bt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},fs={__name:"Leads",setup(b){const{getFormattedPercent:X,getFormattedFloat:Y,getFormattedCurrency:C}=qe("CRM Lead"),{makeCall:K}=We(),{getUser:$}=je(),{getLeadStatus:B}=Qe(),E=ce(),q=w(null),M=w(!1),I=he({}),n=w({}),f=w(1),A=w(1),W=w(20),V=w(null);function s(r,t){var k;function g(d){return d&&typeof d=="object"&&!Array.isArray(d)?d:{label:d}}return g((k=m.value)==null?void 0:k.find(d=>d.name==r)[t])}const m=ee(()=>{var r,t,g,k,d,e,l;return(t=(r=n.value)==null?void 0:r.data)!=null&&t.data?n.value.data.view_type==="group_by"?(k=(g=n.value)==null?void 0:g.data.group_by_field)!=null&&k.fieldname?c((d=n.value)==null?void 0:d.data.data,(e=n.value)==null?void 0:e.data.group_by_field,n.value.data.columns):[]:n.value.data.view_type==="kanban"?Z(n.value.data.data,n.value.data.fields):T((l=n.value)==null?void 0:l.data.data,n.value.data.columns):[]});function c(r,t,g){var d;let k=[];return(d=t.options)==null||d.forEach(e=>{let l=[];e?l=r.filter(o=>o[t.fieldname]==e):l=r.filter(o=>!o[t.fieldname]);let j={label:t.label,group:e||__(" "),collapsed:!1,rows:T(l,g)};t.fieldname=="status"&&(j.icon=()=>{var o;return G(Q,{class:(o=B(e))==null?void 0:o.color})}),k.push(j)}),k||r}function Z(r,t){let g=[];return r.forEach(k=>{var d;(d=k.data)==null||d.forEach(e=>{g.push(e)})}),T(g,t)}function T(r,t=[]){let g=n.value.data.view_type,k=g==="kanban"?"fieldname":"key",d=g==="kanban"?"fieldtype":"type";return r.map(e=>{var j;let l={};return(j=n.value)==null||j.data.rows.forEach(o=>{var ae,oe;l[o]=e[o];let z=(ae=t==null?void 0:t.find(x=>(x[k]||x.value)==o))==null?void 0:ae[d];if(z&&["Date","Datetime"].includes(z)&&!["modified","creation"].includes(o)&&(l[o]=F(e[o],"",!0,z=="Datetime")),z&&z=="Currency"&&(l[o]=C(o,e)),z&&z=="Float"&&(l[o]=Y(o,e)),z&&z=="Percent"&&(l[o]=X(o,e)),o=="lead_name")l[o]={label:e.lead_name,image:e.image,image_label:e.first_name};else if(o=="organization")l[o]=e.organization;else if(o==="website")l[o]=Ke(e.website);else if(o=="status")l[o]={label:e.status,color:(oe=B(e.status))==null?void 0:oe.color};else if(o=="sla_status"){let x=e.sla_status,D=x,ne=e.sla_status=="Failed"?"red":e.sla_status=="Fulfilled"?"green":"orange";x=="First Response Due"&&(x=__(N(e.response_by)),D=F(e.response_by),new Date(e.response_by)<new Date&&(ne="red")),l[o]={label:D,value:x,color:ne}}else if(o=="lead_owner")l[o]={label:e.lead_owner&&$(e.lead_owner).full_name,...e.lead_owner&&$(e.lead_owner)};else if(o=="_assign"){let x=JSON.parse(e._assign||"[]");l[o]=x.map(D=>({name:D,image:$(D).user_image,label:$(D).full_name}))}else if(["modified","creation"].includes(o))l[o]={label:F(e[o]),timeAgo:__(N(e[o]))};else if(["first_response_time","first_responded_on","response_by"].includes(o)){let x=o=="response_by"?"response_by":"first_responded_on";l[o]={label:e[x]?F(e[x]):"",timeAgo:e[o]?o=="first_response_time"?Oe(e[o]):__(N(e[o])):""}}}),l._email_count=e._email_count,l._note_count=e._note_count,l._task_count=e._task_count,l._comment_count=e._comment_count,l})}function R(r){let t=n.value.params.column_field;t&&(I[t]=r.column.name),M.value=!0}function ve(r){var k;let t=((k=s(r,"mobile_no"))==null?void 0:k.label)||"";return[{icon:G(le,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>K(t),condition:()=>t&&Xe.value},{icon:G(re,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>ye(r)},{icon:G(de,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ge(r)}].filter(d=>d.condition?d.condition():!0)}const O=w(""),H=w(!1),ke=w({title:"",content:""});function ye(r){O.value=r,H.value=!0}const J=w(!1),be=w({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ge(r){O.value=r,J.value=!0}return(r,t)=>{const g=S("FeatherIcon"),k=S("Button"),d=S("Badge");return a(),u(te,null,[i(Te,null,{"left-header":v(()=>[i(Le,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),routeName:"Leads"},null,8,["modelValue"])]),"right-header":v(()=>{var e;return[(e=q.value)!=null&&e.customListActions?(a(),y($e,{key:0,actions:q.value.customListActions},null,8,["actions"])):p("",!0),i(k,{variant:"solid",label:r.__("Create"),onClick:t[1]||(t[1]=l=>M.value=!0)},{prefix:v(()=>[i(g,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),i(Ve,{ref_key:"viewControls",ref:V,modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),loadMore:f.value,"onUpdate:loadMore":t[3]||(t[3]=e=>f.value=e),resizeColumn:A.value,"onUpdate:resizeColumn":t[4]||(t[4]=e=>A.value=e),updatedPageCount:W.value,"onUpdate:updatedPageCount":t[5]||(t[5]=e=>W.value=e),doctype:"CRM Lead",filters:{converted:0},options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),_(E).params.viewType=="kanban"?(a(),y(Je,{key:0,modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=e=>n.value=e),options:{getRoute:e=>({name:"Lead",params:{leadId:e.name},query:{view:_(E).query.view,viewType:_(E).params.viewType}}),onNewClick:e=>R(e)},onUpdate:t[8]||(t[8]=e=>V.value.updateKanbanSettings(e)),onLoadMore:t[9]||(t[9]=e=>V.value.loadMoreKanban(e))},{title:v(({titleField:e,itemName:l})=>[L("div",ut,[e==="status"?(a(),u("div",rt,[i(Q,{class:P(s(l,e).color)},null,8,["class"])])):e==="organization"&&s(l,e).label?(a(),u("div",dt,[i(_(U),{class:"flex items-center",image:s(l,e).logo,label:s(l,e).label,size:"sm"},null,8,["image","label"])])):e==="lead_name"&&s(l,e).label?(a(),u("div",_t,[i(_(U),{class:"flex items-center",image:s(l,e).image,label:s(l,e).image_label,size:"sm"},null,8,["image","label"])])):e==="lead_owner"&&s(l,e).full_name?(a(),u("div",ct,[i(_(U),{class:"flex items-center",image:s(l,e).user_image,label:s(l,e).full_name,size:"sm"},null,8,["image","label"])])):e==="mobile_no"?(a(),u("div",pt,[i(le,{class:"h-4 w-4"})])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),u("div",ft,[i(_(se),{text:s(l,e).label},{default:v(()=>[L("div",null,h(s(l,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),u("div",mt,[s(l,e).value?(a(),y(d,{key:0,variant:"subtle",theme:s(l,e).color,size:"md",label:s(l,e).value},null,8,["theme","label"])):p("",!0)])):s(l,e).label?(a(),u("div",vt,h(s(l,e).label),1)):(a(),u("div",kt,h(r.__("No Title")),1))])]),fields:v(({fieldName:e,itemName:l})=>[s(l,e).label?(a(),u("div",yt,[e==="status"?(a(),u("div",bt,[i(Q,{class:P(s(l,e).color)},null,8,["class"])])):e==="organization"&&s(l,e).label?(a(),u("div",gt,[i(_(U),{class:"flex items-center",image:s(l,e).logo,label:s(l,e).label,size:"xs"},null,8,["image","label"])])):e==="lead_name"?(a(),u("div",Ct,[s(l,e).label?(a(),y(_(U),{key:0,class:"flex items-center",image:s(l,e).image,label:s(l,e).image_label,size:"xs"},null,8,["image","label"])):p("",!0)])):e==="lead_owner"?(a(),u("div",wt,[s(l,e).full_name?(a(),y(_(U),{key:0,class:"flex items-center",image:s(l,e).user_image,label:s(l,e).full_name,size:"xs"},null,8,["image","label"])):p("",!0)])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),u("div",xt,[i(_(se),{text:s(l,e).label},{default:v(()=>[L("div",null,h(s(l,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),u("div",ht,[s(l,e).value?(a(),y(d,{key:0,variant:"subtle",theme:s(l,e).color,size:"md",label:s(l,e).value},null,8,["theme","label"])):p("",!0)])):e==="_assign"?(a(),u("div",Vt,[i(fe,{avatars:s(l,e).label,size:"xs"},null,8,["avatars"])])):(a(),u("div",Lt,h(s(l,e).label),1))])):p("",!0)]),actions:v(({itemName:e})=>[L("div",$t,[L("div",Mt,[i(Me,{class:"h-4 w-4"}),s(e,"_email_count").label?(a(),u("span",zt,h(s(e,"_email_count").label),1)):p("",!0),t[23]||(t[23]=L("span",{class:"text-3xl leading-[0]"}," · ",-1)),i(re,{class:"h-4 w-4"}),s(e,"_note_count").label?(a(),u("span",Ut,h(s(e,"_note_count").label),1)):p("",!0),t[24]||(t[24]=L("span",{class:"text-3xl leading-[0]"}," · ",-1)),i(de,{class:"h-4 w-4"}),s(e,"_task_count").label?(a(),u("span",At,h(s(e,"_task_count").label),1)):p("",!0),t[25]||(t[25]=L("span",{class:"text-3xl leading-[0]"}," · ",-1)),i(Ue,{class:"h-4 w-4"}),s(e,"_comment_count").label?(a(),u("span",Tt,h(s(e,"_comment_count").label),1)):p("",!0)]),i(_(me),{class:"flex items-center gap-2",options:ve(e),variant:"ghost",onClick:t[6]||(t[6]=pe(()=>{},["stop","prevent"]))},{default:v(()=>[i(k,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):n.value.data&&m.value.length?(a(),y(it,{key:1,ref_key:"leadsListView",ref:q,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":t[10]||(t[10]=e=>n.value.data.page_length_count=e),list:n.value,"onUpdate:list":t[11]||(t[11]=e=>n.value=e),rows:m.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:t[12]||(t[12]=()=>f.value++),onColumnWidthUpdated:t[13]||(t[13]=()=>A.value++),onUpdatePageCount:t[14]||(t[14]=e=>W.value=e),onApplyFilter:t[15]||(t[15]=e=>V.value.applyFilter(e)),onApplyLikeFilter:t[16]||(t[16]=e=>V.value.applyLikeFilter(e)),onLikeDoc:t[17]||(t[17]=e=>V.value.likeDoc(e)),onSelectionsChanged:t[18]||(t[18]=e=>V.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(a(),u("div",Rt,[L("div",Bt,[i(Ae,{class:"h-10 w-10"}),L("span",null,h(r.__("No {0} Found",[r.__("Leads")])),1),i(k,{label:r.__("Create"),onClick:t[19]||(t[19]=e=>M.value=!0)},{prefix:v(()=>[i(g,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):p("",!0),M.value?(a(),y(Ge,{key:3,modelValue:M.value,"onUpdate:modelValue":t[20]||(t[20]=e=>M.value=e),defaults:I},null,8,["modelValue","defaults"])):p("",!0),H.value?(a(),y(ze,{key:4,modelValue:H.value,"onUpdate:modelValue":t[21]||(t[21]=e=>H.value=e),note:ke.value,doctype:"CRM Lead",doc:O.value},null,8,["modelValue","note","doc"])):p("",!0),J.value?(a(),y(Fe,{key:5,modelValue:J.value,"onUpdate:modelValue":t[22]||(t[22]=e=>J.value=e),task:be.value,doctype:"CRM Lead",doc:O.value},null,8,["modelValue","task","doc"])):p("",!0)],64)}}};export{fs as default};
//# sourceMappingURL=Leads-39196427.js.map
