import{m as ge,i as be,B as ye,l as v,k as ke,z as ne,j as _e,a as xe,e as P,f as o,g as h,w as V,d as f,t as D,u as y,b as r,p,c as d,J as Ce,I as he,v as we,F as Ve,h as De,n as ue,_ as ie,q as Me,x as Q}from"./index-77a1adb3.js";import{_ as ze,a as Ee}from"./ViewControls-0243c1de.js";import{_ as $e}from"./MultipleAvatar-812974f4.js";import{_ as Re}from"./CustomActions-cc223af8.js";import{E as Ue}from"./EmailAtIcon-433e8e29.js";import{P as Ie}from"./PhoneIcon-cf282ece.js";import{_ as Se,N as re}from"./NoteModal-ef63f4f5.js";import{T as de}from"./TaskIcon-95e40b66.js";import{C as Te}from"./CommentIcon-aa645985.js";import{I as ee}from"./IndicatorIcon-81343f13.js";import{D as Ae}from"./DealsIcon-b1eef88d.js";import{_ as Le}from"./LayoutHeader-bf851e4e.js";import{_ as Pe}from"./DealsListView-316d58ce.js";import{_ as Be}from"./KanbanView-5dcce96f.js";import{i as Oe,E as je,c as qe}from"./DragVerticalIcon-56a1fcba.js";import{F as Qe}from"./FieldLayout-9051362d.js";import{u as pe,b as Ke,g as Je,a as K,f as J,w as We,t as te,c as Ge}from"./index-1be1092b.js";import{s as fe}from"./statuses-2b43883f.js";import{u as He,c as Xe,q as Ye}from"./modals-6b779b18.js";import{_ as ce}from"./Switch.vue_vue_type_script_setup_true_lang-1c082bf5.js";import{T as Ze}from"./TaskModal-f9c99550.js";import{o as Fe}from"./organizations-a3c87877.js";import{_ as Ne}from"./Dropdown.vue_vue_type_script_setup_true_lang-20f66514.js";import"./FadedScrollableDiv-3bd2f113.js";import"./IconPicker-32bf6d73.js";import"./Popover-23375de3.js";import"./PinIcon-9a9cf1df.js";import"./DetailsIcon-5fbd1b96.js";import"./settings-efea4d57.js";import"./ArrowUpRightIcon-8e3aac11.js";import"./helpCenter-caf03f7d.js";import"./ListRows-f93bf621.js";import"./AssignmentModal-615be241.js";import"./ListFooter-88c0e00f.js";import"./label-ea862e17.js";const et={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},tt={class:"mb-5 flex items-center justify-between"},at={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},st={class:"flex items-center gap-1"},ot={key:0,class:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},lt={key:0,class:"flex items-center gap-3 text-sm text-ink-gray-5"},nt={key:1,class:"flex items-center gap-3 text-sm text-ink-gray-5"},ut={key:1,class:"h-px w-full border-t my-5"},it={class:"px-4 pb-7 pt-4 sm:px-6"},rt={class:"flex flex-row-reverse gap-2"},dt={__name:"DealModal",props:ge({defaults:Object},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(W){const G=W,{getUser:H,isManager:X}=pe(),{getDealStatus:Y,statusOptions:B}=fe(),T=be(W,"modelValue"),q=ye(),g=v(null),{document:n,triggerOnChange:R}=He("CRM Deal"),U=v(!0),u=v(!0),I=v(!1),S=v(!1),A=v(!1),z=v(null);ke([A,S],([_,C])=>{s.data.forEach(E=>{E.sections.forEach(b=>{b.name==="organization_section"?b.hidden=!_:b.name==="organization_details_section"?b.hidden=_:b.name==="contact_section"?b.hidden=!C:b.name==="contact_details_section"&&(b.hidden=C)})})});const s=ne({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Deal"],params:{doctype:"CRM Deal",type:"Quick Entry"},auto:!0,transform:_=>(U.value=!1,_.forEach(C=>{C.sections.forEach(E=>{E.columns.forEach(b=>{["organization_section","organization_details_section"].includes(E.name)?U.value=!0:["contact_section","contact_details_section"].includes(E.name)&&(u.value=!0),b.fields.forEach(w=>{w.fieldname=="status"&&(w.fieldtype="Select",w.options=L.value,w.prefix=Y(n.doc.status).color),w.fieldtype==="Table"&&(n.doc[w.fieldname]=[])})})})}))}),L=_e(()=>{let _=B("deal",null,[],R);return n.doc.status||(n.doc.status=_[0].value),_});function Z(){n.doc.website&&!n.doc.website.startsWith("http")&&(n.doc.website="https://"+n.doc.website),S.value?(n.doc.first_name=null,n.doc.last_name=null,n.doc.email=null,n.doc.mobile_no=null):n.doc.contact=null,ne({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:n.doc},auto:!0,validate(){if(g.value=null,n.doc.annual_revenue){if(typeof n.doc.annual_revenue=="string")n.doc.annual_revenue=n.doc.annual_revenue.replace(/,/g,"");else if(isNaN(n.doc.annual_revenue))return g.value=__("Annual Revenue should be a number"),g.value}if(n.doc.mobile_no&&isNaN(n.doc.mobile_no.replace(/[-+() ]/g,"")))return g.value=__("Mobile No should be a number"),g.value;if(n.doc.email&&!n.doc.email.includes("@"))return g.value=__("Invalid Email"),g.value;if(!n.doc.status)return g.value=__("Status is required"),g.value;I.value=!0},onSuccess(_){Ce("deal_created"),I.value=!1,T.value=!1,q.push({name:"Deal",params:{dealId:_}})},onError(_){if(I.value=!1,!_.messages){g.value=_.message;return}g.value=_.messages.join(`
`)}})}function F(){Xe.value=!0,Ye.value={doctype:"CRM Deal"},he(()=>T.value=!1)}return xe(()=>{n.doc={no_of_employees:"1-10"},Object.assign(n.doc,G.defaults),n.doc.deal_owner||(n.doc.deal_owner=H().name),!n.doc.status&&L.value[0].value&&(n.doc.status=L.value[0].value)}),(_,C)=>{const E=P("Button"),b=P("FeatherIcon"),w=P("ErrorMessage"),N=P("Dialog");return o(),h(N,{modelValue:T.value,"onUpdate:modelValue":C[3]||(C[3]=O=>T.value=O),options:{size:"3xl"}},{body:V(()=>{var O;return[f("div",et,[f("div",tt,[f("div",null,[f("h3",at,D(_.__("Create Deal")),1)]),f("div",st,[y(X)()&&!y(Oe)?(o(),h(E,{key:0,variant:"ghost",class:"w-7",onClick:F},{icon:V(()=>[r(je)]),_:1})):p("",!0),r(E,{variant:"ghost",class:"w-7",onClick:C[0]||(C[0]=$=>T.value=!1)},{icon:V(()=>[r(b,{name:"x",class:"size-4"})]),_:1})])]),f("div",null,[U.value||u.value?(o(),d("div",ot,[U.value?(o(),d("div",lt,[f("div",null,D(_.__("Choose Existing Organization")),1),r(y(ce),{modelValue:A.value,"onUpdate:modelValue":C[1]||(C[1]=$=>A.value=$)},null,8,["modelValue"])])):p("",!0),u.value?(o(),d("div",nt,[f("div",null,D(_.__("Choose Existing Contact")),1),r(y(ce),{modelValue:S.value,"onUpdate:modelValue":C[2]||(C[2]=$=>S.value=$)},null,8,["modelValue"])])):p("",!0)])):p("",!0),U.value||u.value?(o(),d("div",ut)):p("",!0),(O=y(s).data)!=null&&O.length?(o(),h(Qe,{key:2,ref_key:"fieldLayoutRef",ref:z,tabs:y(s).data,data:y(n).doc,doctype:"CRM Deal"},null,8,["tabs","data"])):p("",!0),g.value?(o(),h(w,{key:3,class:"mt-4",message:_.__(g.value)},null,8,["message"])):p("",!0)])]),f("div",it,[f("div",rt,[r(E,{variant:"solid",label:_.__("Create"),loading:I.value,onClick:Z},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},ct={class:"flex gap-2 items-center"},_t={key:0},pt={key:1},ft={key:2},mt={key:3,class:"truncate text-base"},vt={key:4,class:"truncate text-base"},gt={key:5,class:"truncate text-base"},bt={key:6,class:"text-ink-gray-4"},yt={key:0,class:"truncate flex items-center gap-2"},kt={key:0},xt={key:1},Ct={key:2},ht={key:3,class:"truncate text-base"},wt={key:4,class:"truncate text-base"},Vt={key:5,class:"flex items-center"},Dt={key:6,class:"truncate text-base"},Mt={class:"flex gap-2 items-center justify-between"},zt={class:"text-ink-gray-5 flex items-center gap-1.5"},Et={key:0},$t={key:1},Rt={key:2},Ut={key:3},It={key:2,class:"flex h-full items-center justify-center"},St={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},va={__name:"Deals",setup(W){const{getFormattedPercent:G,getFormattedFloat:H,getFormattedCurrency:X}=Ke("CRM Deal"),{makeCall:Y}=Je(),{getUser:B}=pe(),{getOrganization:T}=Fe(),{getDealStatus:q}=fe(),g=De(),n=v(null),R=v(!1),U=we({}),u=v({}),I=v(1),S=v(1),A=v(20),z=v(null);function s(i,t){var m;function k(c){return c&&typeof c=="object"&&!Array.isArray(c)?c:{label:c}}return k((m=L.value)==null?void 0:m.find(c=>c.name==i)[t])}const L=_e(()=>{var i,t,k,m,c,e,a;return(t=(i=u.value)==null?void 0:i.data)!=null&&t.data?u.value.data.view_type==="group_by"?(m=(k=u.value)==null?void 0:k.data.group_by_field)!=null&&m.fieldname?Z((c=u.value)==null?void 0:c.data.data,(e=u.value)==null?void 0:e.data.group_by_field,u.value.data.columns):[]:u.value.data.view_type==="kanban"?F(u.value.data.data,u.value.data.fields):_((a=u.value)==null?void 0:a.data.data,u.value.data.columns):[]});function Z(i,t,k){var c;let m=[];return(c=t.options)==null||c.forEach(e=>{let a=[];e?a=i.filter(x=>x[t.fieldname]==e):a=i.filter(x=>!x[t.fieldname]);let l={label:t.label,group:e||__(" "),collapsed:!1,rows:_(a,k)};t.fieldname=="status"&&(l.icon=()=>{var x;return Q(ee,{class:(x=q(e))==null?void 0:x.color})}),m.push(l)}),m||i}function F(i,t){let k=[];return i.forEach(m=>{var c;(c=m.data)==null||c.forEach(e=>{k.push(e)})}),_(k,t)}function _(i,t=[]){let k=u.value.data.view_type,m=k==="kanban"?"fieldname":"key",c=k==="kanban"?"fieldtype":"type";return i.map(e=>{let a={};return u.value.data.rows.forEach(l=>{var ae,se,oe;a[l]=e[l];let x=(ae=t==null?void 0:t.find(M=>(M[m]||M.value)==l))==null?void 0:ae[c];if(x&&["Date","Datetime"].includes(x)&&!["modified","creation"].includes(l)&&(a[l]=J(e[l],"",!0,x=="Datetime")),x&&x=="Currency"&&(a[l]=X(l,e)),x&&x=="Float"&&(a[l]=H(l,e)),x&&x=="Percent"&&(a[l]=G(l,e)),l=="organization")a[l]={label:e.organization,logo:(se=T(e.organization))==null?void 0:se.organization_logo};else if(l==="website")a[l]=We(e.website);else if(l=="status")a[l]={label:e.status,color:(oe=q(e.status))==null?void 0:oe.color};else if(l=="sla_status"){let M=e.sla_status,j=M,le=e.sla_status=="Failed"?"red":e.sla_status=="Fulfilled"?"green":"orange";M=="First Response Due"&&(M=__(te(e.response_by)),j=J(e.response_by),new Date(e.response_by)<new Date&&(le="red")),a[l]={label:j,value:M,color:le}}else if(l=="deal_owner")a[l]={label:e.deal_owner&&B(e.deal_owner).full_name,...e.deal_owner&&B(e.deal_owner)};else if(l=="_assign"){let M=JSON.parse(e._assign||"[]");a[l]=M.map(j=>({name:j,image:B(j).user_image,label:B(j).full_name}))}else if(["modified","creation"].includes(l))a[l]={label:J(e[l]),timeAgo:__(te(e[l]))};else if(["first_response_time","first_responded_on","response_by"].includes(l)){let M=l=="response_by"?"response_by":"first_responded_on";a[l]={label:e[M]?J(e[M]):"",timeAgo:e[l]?l=="first_response_time"?Ge(e[l]):__(te(e[l])):""}}}),a._email_count=e._email_count,a._note_count=e._note_count,a._task_count=e._task_count,a._comment_count=e._comment_count,a})}function C(i){let t=u.value.params.column_field;t&&(U[t]=i.column.name),R.value=!0}function E(i){var m;let t=((m=s(i,"mobile_no"))==null?void 0:m.label)||"";return[{icon:Q(Ie,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>Y(t),condition:()=>t&&qe.value},{icon:Q(re,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>O(i)},{icon:Q(de,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ve(i)}].filter(c=>c.condition?c.condition():!0)}const b=v(""),w=v(!1),N=v({title:"",content:""});function O(i){b.value=i,w.value=!0}const $=v(!1),me=v({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ve(i){b.value=i,$.value=!0}return(i,t)=>{const k=P("FeatherIcon"),m=P("Button"),c=P("Badge");return o(),d(Ve,null,[r(Le,null,{"left-header":V(()=>[r(Ee,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),routeName:"Deals"},null,8,["modelValue"])]),"right-header":V(()=>{var e;return[(e=n.value)!=null&&e.customListActions?(o(),h(Re,{key:0,actions:n.value.customListActions},null,8,["actions"])):p("",!0),r(m,{variant:"solid",label:i.__("Create"),onClick:t[1]||(t[1]=a=>R.value=!0)},{prefix:V(()=>[r(k,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),r(ze,{ref_key:"viewControls",ref:z,modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),loadMore:I.value,"onUpdate:loadMore":t[3]||(t[3]=e=>I.value=e),resizeColumn:S.value,"onUpdate:resizeColumn":t[4]||(t[4]=e=>S.value=e),updatedPageCount:A.value,"onUpdate:updatedPageCount":t[5]||(t[5]=e=>A.value=e),doctype:"CRM Deal",options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),y(g).params.viewType=="kanban"?(o(),h(Be,{key:0,modelValue:u.value,"onUpdate:modelValue":t[7]||(t[7]=e=>u.value=e),options:{getRoute:e=>({name:"Deal",params:{dealId:e.name},query:{view:y(g).query.view,viewType:y(g).params.viewType}}),onNewClick:e=>C(e)},onUpdate:t[8]||(t[8]=e=>z.value.updateKanbanSettings(e)),onLoadMore:t[9]||(t[9]=e=>z.value.loadMoreKanban(e))},{title:V(({titleField:e,itemName:a})=>[f("div",ct,[e==="status"?(o(),d("div",_t,[r(ee,{class:ue(s(a,e).color)},null,8,["class"])])):e==="organization"&&s(a,e).label?(o(),d("div",pt,[r(y(K),{class:"flex items-center",image:s(a,e).logo,label:s(a,e).label,size:"sm"},null,8,["image","label"])])):e==="deal_owner"&&s(a,e).full_name?(o(),d("div",ft,[r(y(K),{class:"flex items-center",image:s(a,e).user_image,label:s(a,e).full_name,size:"sm"},null,8,["image","label"])])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(o(),d("div",mt,[r(y(ie),{text:s(a,e).label},{default:V(()=>[f("div",null,D(s(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(o(),d("div",vt,[s(a,e).value?(o(),h(c,{key:0,variant:"subtle",theme:s(a,e).color,size:"md",label:s(a,e).value},null,8,["theme","label"])):p("",!0)])):s(a,e).label?(o(),d("div",gt,D(s(a,e).label),1)):(o(),d("div",bt,D(i.__("No Title")),1))])]),fields:V(({fieldName:e,itemName:a})=>[s(a,e).label?(o(),d("div",yt,[e==="status"?(o(),d("div",kt,[r(ee,{class:ue(s(a,e).color)},null,8,["class"])])):e==="organization"?(o(),d("div",xt,[s(a,e).label?(o(),h(y(K),{key:0,class:"flex items-center",image:s(a,e).logo,label:s(a,e).label,size:"xs"},null,8,["image","label"])):p("",!0)])):e==="deal_owner"?(o(),d("div",Ct,[s(a,e).full_name?(o(),h(y(K),{key:0,class:"flex items-center",image:s(a,e).user_image,label:s(a,e).full_name,size:"xs"},null,8,["image","label"])):p("",!0)])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(o(),d("div",ht,[r(y(ie),{text:s(a,e).label},{default:V(()=>[f("div",null,D(s(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(o(),d("div",wt,[s(a,e).value?(o(),h(c,{key:0,variant:"subtle",theme:s(a,e).color,size:"md",label:s(a,e).value},null,8,["theme","label"])):p("",!0)])):e==="_assign"?(o(),d("div",Vt,[r($e,{avatars:s(a,e).label,size:"xs"},null,8,["avatars"])])):(o(),d("div",Dt,D(s(a,e).label),1))])):p("",!0)]),actions:V(({itemName:e})=>[f("div",Mt,[f("div",zt,[r(Ue,{class:"h-4 w-4"}),s(e,"_email_count").label?(o(),d("span",Et,D(s(e,"_email_count").label),1)):p("",!0),t[23]||(t[23]=f("span",{class:"text-3xl leading-[0]"}," · ",-1)),r(re,{class:"h-4 w-4"}),s(e,"_note_count").label?(o(),d("span",$t,D(s(e,"_note_count").label),1)):p("",!0),t[24]||(t[24]=f("span",{class:"text-3xl leading-[0]"}," · ",-1)),r(de,{class:"h-4 w-4"}),s(e,"_task_count").label?(o(),d("span",Rt,D(s(e,"_task_count").label),1)):p("",!0),t[25]||(t[25]=f("span",{class:"text-3xl leading-[0]"}," · ",-1)),r(Te,{class:"h-4 w-4"}),s(e,"_comment_count").label?(o(),d("span",Ut,D(s(e,"_comment_count").label),1)):p("",!0)]),r(y(Ne),{class:"flex items-center gap-2",options:E(e),variant:"ghost",onClick:t[6]||(t[6]=Me(()=>{},["stop","prevent"]))},{default:V(()=>[r(m,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):u.value.data&&L.value.length?(o(),h(Pe,{key:1,ref_key:"dealsListView",ref:n,modelValue:u.value.data.page_length_count,"onUpdate:modelValue":t[10]||(t[10]=e=>u.value.data.page_length_count=e),list:u.value,"onUpdate:list":t[11]||(t[11]=e=>u.value=e),rows:L.value,columns:u.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:u.value.data.row_count,totalCount:u.value.data.total_count},onLoadMore:t[12]||(t[12]=()=>I.value++),onColumnWidthUpdated:t[13]||(t[13]=()=>S.value++),onUpdatePageCount:t[14]||(t[14]=e=>A.value=e),onApplyFilter:t[15]||(t[15]=e=>z.value.applyFilter(e)),onApplyLikeFilter:t[16]||(t[16]=e=>z.value.applyLikeFilter(e)),onLikeDoc:t[17]||(t[17]=e=>z.value.likeDoc(e)),onSelectionsChanged:t[18]||(t[18]=e=>z.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):u.value.data?(o(),d("div",It,[f("div",St,[r(Ae,{class:"h-10 w-10"}),f("span",null,D(i.__("No {0} Found",[i.__("Deals")])),1),r(m,{label:i.__("Create"),onClick:t[19]||(t[19]=e=>R.value=!0)},{prefix:V(()=>[r(k,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):p("",!0),R.value?(o(),h(dt,{key:3,modelValue:R.value,"onUpdate:modelValue":t[20]||(t[20]=e=>R.value=e),defaults:U},null,8,["modelValue","defaults"])):p("",!0),w.value?(o(),h(Se,{key:4,modelValue:w.value,"onUpdate:modelValue":t[21]||(t[21]=e=>w.value=e),note:N.value,doctype:"CRM Deal",doc:b.value},null,8,["modelValue","note","doc"])):p("",!0),$.value?(o(),h(Ze,{key:5,modelValue:$.value,"onUpdate:modelValue":t[22]||(t[22]=e=>$.value=e),task:me.value,doctype:"CRM Deal",doc:b.value},null,8,["modelValue","task","doc"])):p("",!0)],64)}}};export{va as default};
//# sourceMappingURL=Deals-bedcb72c.js.map
