import{_ as _e,a as pe}from"./Resizer-90c7afcc.js";import{_ as fe}from"./FadedScrollableDiv-3bd2f113.js";import{S as ge,g as ve}from"./view-4ccef3d8.js";import{_ as he}from"./LayoutHeader-bf851e4e.js";import{P as ye}from"./PhoneIcon-cf282ece.js";import{C as be}from"./CameraIcon-064319e5.js";import{D as we}from"./DealsIcon-b1eef88d.js";import{_ as Ce}from"./DealsListView-316d58ce.js";import{g as ke,u as xe,b as Q,a as W,v as De,f as Ie,t as ze}from"./index-1be1092b.js";import{_ as Se,s as Me,a as $e}from"./modals-6b779b18.js";import{g as Pe}from"./settings-efea4d57.js";import{o as Fe}from"./organizations-a3c87877.js";import{s as Re}from"./statuses-2b43883f.js";import{c as Ae}from"./DragVerticalIcon-56a1fcba.js";import{l as $,z as E,j as w,A as Be,x as Ee,c as C,u as t,g as f,w as p,p as _,b as u,F as Ne,h as Te,B as qe,e as P,f as r,d as c,C as N,y as Ve,t as k,D as X,n as Y,E as x,G as F}from"./index-77a1adb3.js";import{_ as je}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c9c1b9c8.js";import{_ as Oe}from"./Dropdown.vue_vue_type_script_setup_true_lang-20f66514.js";import{F as Ue}from"./FileUploader-1509b35b.js";import"./ArrowUpRightIcon-8e3aac11.js";import"./ListRows-f93bf621.js";import"./AssignmentModal-615be241.js";import"./MultipleAvatar-812974f4.js";import"./IndicatorIcon-81343f13.js";import"./ListFooter-88c0e00f.js";import"./label-ea862e17.js";const Le={key:1,ref:"parentRef",class:"flex h-full"},Ge={class:"border-b"},He={class:"flex flex-col items-start justify-start gap-4 p-5"},Je={class:"flex gap-4 items-center"},Ke={class:"group relative h-15.5 w-15.5"},Qe={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},We={class:"flex flex-col gap-2 truncate text-ink-gray-9"},Xe={class:"truncate text-2xl font-medium"},Ye={key:0},Ze={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},ea={class:""},aa={class:"flex gap-1.5"},ta={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},oa={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},na={class:"flex flex-col items-center justify-center space-y-3"},$a={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(Z){const{brand:ee}=Pe(),{$dialog:ae,makeCall:te}=ke(),{getUser:T}=xe(),{getOrganization:q}=Fe(),{getDealStatus:oe}=Re(),{doctypeMeta:ne}=Q("Contact"),g=Z,b=Te(),V=qe(),m=$({}),z=$(""),R=$(""),a=E({url:"crm.api.contact.get_contact",cache:["contact",g.contactId],params:{name:g.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no}),onSuccess:()=>{z.value="",R.value=""},onError:e=>{var o,i;(o=e.messages)!=null&&o[0]?(z.value=__("Not permitted"),R.value=__((i=e.messages)==null?void 0:i[0])):V.push({name:"Contacts"})}}),se=w(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(b.query.view||b.query.viewType){let o=ve(b.query.view,b.query.viewType,"Contact");o&&e.push({label:__(o.label),icon:o.icon,route:{name:"Contacts",params:{viewType:b.query.viewType},query:{view:b.query.view}}})}return e.push({label:j.value,route:{name:"Contact",params:{contactId:g.contactId}}}),e}),j=w(()=>{var o,i;let e=((o=ne.Contact)==null?void 0:o.title_field)||"name";return((i=a.data)==null?void 0:i[e])||g.contactId});Be(()=>({title:j.value,icon:ee.favicon}));async function O(e){await x("frappe.client.set_value",{doctype:"Contact",name:g.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),a.reload()}async function le(){ae({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await x("frappe.client.delete",{doctype:"Contact",name:g.contactId}),e(),V.push({name:"Contacts"})}}]})}const U=$(0),ie=[{label:"Deals",icon:Ee(we,{class:"h-4 w-4"}),count:w(()=>{var e;return(e=S.data)==null?void 0:e.length})}],S=E({url:"crm.api.contact.get_linked_deals",cache:["deals",g.contactId],params:{contact:g.contactId},auto:!0}),A=w(()=>!S.data||S.data==[]?[]:S.data.map(e=>de(e))),B=E({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0,transform:e=>w(()=>re(e))});function re(e){return e.map(o=>(o.columns=o.columns.map(i=>(i.fields=i.fields.map(d=>{var D,M,l,v;return d.fieldname==="email_id"?{...d,read_only:!1,fieldtype:"Dropdown",options:((M=(D=a.data)==null?void 0:D.email_ids)==null?void 0:M.map(s=>({name:s.name,value:s.email_id,selected:s.email_id===a.data.email_id,placeholder:"john@doe.com",onClick:()=>{m.value.email_id=s.email_id,L("email",s.email_id)},onSave:(n,h)=>{h?(G("email",n.value),a.data.email_ids.length===1&&(m.value.email_id=n.value)):H("Contact Email",n.name,"email_id",n.value)},onDelete:async(n,h)=>{var I;a.data.email_ids=a.data.email_ids.filter(y=>y.name!==n.name),!h&&await J("Contact Email",n.name),m.value.email_id===n.value&&(a.data.email_ids.length===0?m.value.email_id="":m.value.email_id=(I=a.data.email_ids.find(y=>y.is_primary))==null?void 0:I.email_id)}})))||[],create:()=>{var s,n;(n=(s=a.data)==null?void 0:s.email_ids)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:d.fieldname==="mobile_no"?{...d,read_only:!1,fieldtype:"Dropdown",options:((v=(l=a.data)==null?void 0:l.phone_nos)==null?void 0:v.map(s=>({name:s.name,value:s.phone,selected:s.phone===a.data.actual_mobile_no,onClick:()=>{m.value.actual_mobile_no=s.phone,m.value.mobile_no=s.phone,L("mobile_no",s.phone)},onSave:(n,h)=>{h?(G("phone",n.value),a.data.phone_nos.length===1&&(m.value.actual_mobile_no=n.value)):H("Contact Phone",n.name,"phone",n.value)},onDelete:async(n,h)=>{var I;a.data.phone_nos=a.data.phone_nos.filter(y=>y.name!==n.name),!h&&await J("Contact Phone",n.name),m.value.actual_mobile_no===n.value&&(a.data.phone_nos.length===0?m.value.actual_mobile_no="":m.value.actual_mobile_no=(I=a.data.phone_nos.find(y=>y.is_primary_mobile_no))==null?void 0:I.phone)}})))||[],create:()=>{var s,n;(n=(s=a.data)==null?void 0:s.phone_nos)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:d.fieldname==="address"?{...d,create:(s,n)=>{m.value.address=s,K(),n()},edit:s=>K(s)}:d}),i)),o))}async function L(e,o){await x("crm.api.contact.set_as_primary",{contact:a.data.name,field:e,value:o})&&(a.reload(),F.success(__("Contact updated")))}async function G(e,o){if(!o)return;await x("crm.api.contact.create_new",{contact:a.data.name,field:e,value:o})&&(a.reload(),F.success(__("Contact updated")))}async function H(e,o,i,d){await x("frappe.client.set_value",{doctype:e,name:o,fieldname:i,value:d})&&(a.reload(),F.success(__("Contact updated")))}async function J(e,o){await x("frappe.client.delete",{doctype:e,name:o}),await a.reload(),F.success(__("Contact updated"))}const{getFormattedCurrency:ce}=Q("CRM Deal"),me=w(()=>ue);function de(e){var o,i;return{name:e.name,organization:{label:e.organization,logo:(o=q(e.organization))==null?void 0:o.organization_logo},annual_revenue:ce("annual_revenue",e),status:{label:e.status,color:(i=oe(e.status))==null?void 0:i.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&T(e.deal_owner).full_name,...e.deal_owner&&T(e.deal_owner)},modified:{label:Ie(e.modified),timeAgo:__(ze(e.modified))}}}const ue=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function K(e){Me.value=!0,$e.value={doctype:"Address",address:e}}return(e,o)=>{const i=P("ErrorMessage"),d=P("Button"),D=P("FeatherIcon"),M=P("Badge");return r(),C(Ne,null,[t(a).data?(r(),f(he,{key:0},{"left-header":p(()=>[u(t(je),{items:se.value},{prefix:p(({item:l})=>[l.icon?(r(),f(fe,{key:0,icon:l.icon,class:"mr-2 h-4"},null,8,["icon"])):_("",!0)]),_:1},8,["items"])]),_:1})):_("",!0),t(a).data?(r(),C("div",Le,[t(a).data?(r(),f(_e,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:p(()=>[c("div",Ge,[u(t(Ue),{onSuccess:O,validateFile:t(De)},{default:p(({openFileSelector:l,error:v})=>{var s;return[c("div",He,[c("div",Je,[c("div",Ke,[u(t(W),{size:"3xl",class:"h-15.5 w-15.5",label:t(a).data.full_name,image:t(a).data.image},null,8,["label","image"]),(r(),f(N(t(a).data.image?t(Oe):"div"),Ve(t(a).data.image?{options:[{icon:"upload",label:t(a).data.image?e.__("Change image"):e.__("Upload image"),onClick:l},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>O("")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[c("div",Qe,[u(be,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),c("div",We,[c("div",Xe,[t(a).data.salutation?(r(),C("span",Ye,k(t(a).data.salutation+". "),1)):_("",!0),c("span",null,k(t(a).data.full_name),1)]),t(a).data.company_name?(r(),C("div",Ze,[u(t(W),{size:"xs",label:t(a).data.company_name,image:(s=t(q)(t(a).data.company_name))==null?void 0:s.organization_logo},null,8,["label","image"]),c("span",ea,k(t(a).data.company_name),1)])):_("",!0),u(i,{message:e.__(v)},null,8,["message"])])]),c("div",aa,[t(a).data.actual_mobile_no?(r(),f(d,{key:0,label:e.__("Make Call"),size:"sm",onClick:o[0]||(o[0]=n=>t(Ae)&&t(te)(t(a).data.actual_mobile_no))},{prefix:p(()=>[u(ye,{class:"h-4 w-4"})]),_:1},8,["label"])):_("",!0),u(d,{label:e.__("Delete"),theme:"red",size:"sm",onClick:le},{prefix:p(()=>[u(D,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])])])]}),_:1},8,["validateFile"])]),t(B).data?(r(),C("div",ta,[u(ge,{sections:t(B).data,doctype:"Contact",docname:t(a).data.name,onReload:t(B).reload},null,8,["sections","docname","onReload"])])):_("",!0)]),_:1},8,["parent"])):_("",!0),u(t(Se),{as:"div",modelValue:U.value,"onUpdate:modelValue":o[1]||(o[1]=l=>U.value=l),tabs:ie},{"tab-item":p(({tab:l,selected:v})=>[c("button",{class:Y(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":v}])},[l.icon?(r(),f(N(l.icon),{key:0,class:"h-5"})):_("",!0),X(" "+k(e.__(l.label))+" ",1),u(M,{class:Y(["group-hover:bg-surface-gray-7",[v?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:p(()=>[X(k(l.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":p(({tab:l})=>[l.label==="Deals"&&A.value.length?(r(),f(Ce,{key:0,class:"mt-4",rows:A.value,columns:me.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):_("",!0),A.value.length?_("",!0):(r(),C("div",oa,[c("div",na,[(r(),f(N(l.icon),{class:"!h-10 !w-10"})),c("div",null,k(e.__("No {0} Found",[e.__(l.label)])),1)])]))]),_:1},8,["modelValue"])],512)):z.value?(r(),f(pe,{key:2,errorTitle:z.value,errorMessage:R.value},null,8,["errorTitle","errorMessage"])):_("",!0)],64)}}};export{$a as default};
//# sourceMappingURL=Contact-93034325.js.map
