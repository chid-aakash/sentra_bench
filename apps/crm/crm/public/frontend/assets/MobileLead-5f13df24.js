import{_ as ie}from"./FadedScrollableDiv-3bd2f113.js";import{D as F}from"./DetailsIcon-5fbd1b96.js";import{u as re,a as de,S as ue,b as me,c as ce,A as pe}from"./useActiveTabManager-5bcbed2e.js";import{E as _e}from"./MultiSelectEmailInput-5f9a8434.js";import{C as fe}from"./CommentIcon-aa645985.js";import{P as ve}from"./PhoneIcon-cf282ece.js";import{T as ye}from"./TaskIcon-95e40b66.js";import{N as be}from"./NoteModal-ef63f4f5.js";import{W as ge}from"./WhatsAppIcon-88b15828.js";import{I as Ce}from"./IndicatorIcon-81343f13.js";import{O as he}from"./OrganizationsIcon-64c9b845.js";import{C as we}from"./ContactsIcon-4e391f66.js";import{_ as xe}from"./LayoutHeader-bf851e4e.js";import{_ as j,i as Ie,c as Le,w as Ve}from"./DragVerticalIcon-56a1fcba.js";import{S as ke,g as Ae}from"./view-4ccef3d8.js";import{_ as W}from"./CustomActions-cc223af8.js";import{g as Me,b as Re,s as De}from"./index-1be1092b.js";import{g as Se}from"./settings-efea4d57.js";import{s as $e}from"./statuses-2b43883f.js";import{u as ze,d as Te,e as Ee,_ as qe}from"./modals-6b779b18.js";import{z as $,G as g,E as z,a as Ne,l as x,j as T,A as Oe,k as Ue,c as C,u as t,g as d,w as c,p as u,b as i,d as r,H as E,F as Pe,h as Be,B as Fe,J as je,e as q,f as n,n as We,t as I}from"./index-77a1adb3.js";import{_ as Ge}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c9c1b9c8.js";import{_ as He}from"./Dropdown.vue_vue_type_script_setup_true_lang-20f66514.js";import{_ as G}from"./Switch.vue_vue_type_script_setup_true_lang-1c082bf5.js";import"./Email2Icon-49565498.js";import"./CalendarIcon-f8132aad.js";import"./CallLogModal-0a4bfef6.js";import"./ArrowUpRightIcon-8e3aac11.js";import"./LeadsIcon-788f061a.js";import"./DealsIcon-b1eef88d.js";import"./TaskModal-f9c99550.js";import"./helpCenter-caf03f7d.js";import"./FieldLayout-9051362d.js";import"./MultipleAvatar-812974f4.js";import"./IconPicker-32bf6d73.js";import"./Popover-23375de3.js";import"./FileUploader-1509b35b.js";import"./EmailTemplateModal-8d3b6520.js";import"./AssignmentModal-615be241.js";import"./label-ea862e17.js";const Je={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Ke={class:"absolute right-0"},Qe={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},Xe={class:"flex items-center gap-2"},Ye={key:2,class:"flex h-full overflow-hidden"},Ze={key:0},ea={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},aa={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},ta={class:"block text-base"},oa={class:"ml-6"},sa={class:"flex items-center justify-between text-base"},la={key:1,class:"mt-2.5 text-base"},na={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},ia={class:"block text-base"},ra={class:"ml-6"},da={class:"flex items-center justify-between text-base"},ua={key:1,class:"mt-2.5 text-base"},Xa={__name:"MobileLead",props:{leadId:{type:String,required:!0}},setup(H){const{brand:J}=Se(),{$dialog:K,$socket:Q}=Me(),{statusOptions:X,getLeadStatus:Y}=$e(),{doctypeMeta:Z}=Re("CRM Lead"),m=Be(),R=Fe(),L=H,o=$({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:L.leadId},cache:["lead",L.leadId],onSuccess:a=>{De(o,{doc:a,$dialog:K,$socket:Q,router:R,toast:g,updateField:O,createToast:g.create,deleteDoc:oe,resource:{lead:o,sections:k},call:z})}});Ne(()=>{o.data||o.fetch()});const D=x(!1);function ee(a,e,l){e=Array.isArray(a)?"":e,!(!Array.isArray(a)&&ae(a,e))&&$({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:L.leadId,fieldname:a,value:e},auto:!0,onSuccess:()=>{o.reload(),D.value=!0,g.success(__("Lead updated successfully")),l==null||l()},onError:y=>{var M;g.error(__(((M=y.messages)==null?void 0:M[0])||"Error updating lead"))}})}function ae(a,e){var y;let l=o.data.fields_meta||{};return(y=l[a])!=null&&y.reqd&&!e?(g.error(__("{0} is a required field",[l[a].label])),!0):!1}const te=T(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];if(m.query.view||m.query.viewType){let e=Ae(m.query.view,m.query.viewType,"CRM Lead");e&&a.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:m.query.viewType},query:{view:m.query.view}}})}return a.push({label:N.value,route:{name:"Lead",params:{leadId:o.data.name}}}),a}),N=T(()=>{var e,l;let a=((e=Z["CRM Lead"])==null?void 0:e.title_field)||"name";return((l=o.data)==null?void 0:l[a])||L.leadId});Oe(()=>({title:N.value,icon:J.favicon}));const V=T(()=>[{name:"Details",label:__("Details"),icon:F,condition:()=>Ie.value},{name:"Activity",label:__("Activity"),icon:ce},{name:"Emails",label:__("Emails"),icon:_e},{name:"Comments",label:__("Comments"),icon:fe},{name:"Data",label:__("Data"),icon:F},{name:"Calls",label:__("Calls"),icon:ve,condition:()=>Le.value},{name:"Tasks",label:__("Tasks"),icon:ye},{name:"Notes",label:__("Notes"),icon:be},{name:"Attachments",label:__("Attachments"),icon:pe},{name:"WhatsApp",label:__("WhatsApp"),icon:ge,condition:()=>Ve.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:p}=re(V,"lastLeadTab");Ue(V,a=>{if(a&&m.params.tabName){let e=a.findIndex(l=>l.name.toLowerCase()===m.params.tabName.toLowerCase());e!==-1&&(p.value=e)}});const k=$({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});function O(a,e,l){ee(a,e,()=>{o.data[a]=e,l==null||l()})}async function oe(a){await z("frappe.client.delete",{doctype:"CRM Lead",name:a}),R.push({name:"Leads"})}const A=x(!1),h=x(!1),w=x(!1),_=x(""),f=x("");async function se(){if(h.value&&!_.value){g.error(__("Please select an existing contact"));return}if(w.value&&!f.value){g.error(__("Please select an existing organization"));return}!h.value&&_.value&&(_.value=""),!w.value&&f.value&&(f.value="");let a=await z("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:o.data.name,deal:{},existing_contact:_.value,existing_organization:f.value});a&&(A.value=!1,h.value=!1,w.value=!1,_.value="",f.value="",je("convert_lead_to_deal"),R.push({name:"Deal",params:{dealId:a}}))}const{assignees:S,document:v,triggerOnChange:le}=ze("CRM Lead",L.leadId);function ne(a){a!=null&&a.hasOwnProperty("lead_owner")&&S.reload()}return(a,e)=>{var U,P,B;const l=q("FeatherIcon"),y=q("Button"),M=q("Dialog");return n(),C(Pe,null,[t(o).data?(n(),d(xe,{key:0},{default:c(()=>[r("header",Je,[i(t(Ge),{items:te.value},{prefix:c(({item:s})=>[s.icon?(n(),d(ie,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):u("",!0)]),_:1},8,["items"]),r("div",Ke,[t(v).doc?(n(),d(t(He),{key:0,options:t(X)("lead",t(v),t(o).data._customStatuses,t(le))},{default:c(({open:s})=>[i(y,{label:t(v).doc.status},{prefix:c(()=>[i(Ce,{class:We(t(Y)(t(v).doc.status).color)},null,8,["class"])]),suffix:c(()=>[i(l,{name:s?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])):u("",!0)])])]),_:1})):u("",!0),t(o).data?(n(),C("div",Qe,[i(de,{modelValue:t(S).data,"onUpdate:modelValue":e[0]||(e[0]=s=>t(S).data=s),data:t(v).doc,doctype:"CRM Lead"},null,8,["modelValue","data"]),r("div",Xe,[(U=t(o).data._customActions)!=null&&U.length?(n(),d(W,{key:0,actions:t(o).data._customActions},null,8,["actions"])):u("",!0),(P=t(v).actions)!=null&&P.length?(n(),d(W,{key:1,actions:t(v).actions},null,8,["actions"])):u("",!0),i(y,{label:a.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=s=>A.value=!0)},null,8,["label"])])])):u("",!0),(B=t(o))!=null&&B.data?(n(),C("div",Ye,[i(t(qe),{as:"div",modelValue:t(p),"onUpdate:modelValue":e[6]||(e[6]=s=>E(p)?p.value=s:null),tabs:V.value,class:"overflow-auto"},{default:c(()=>[i(t(Te),{class:"!px-3"}),i(t(Ee),null,{default:c(({tab:s})=>[s.name=="Details"?(n(),C("div",Ze,[t(o).data.sla_status?(n(),d(ue,{key:0,modelValue:t(o).data,"onUpdate:modelValue":e[2]||(e[2]=b=>t(o).data=b),onUpdateField:O},null,8,["modelValue"])):u("",!0),t(k).data?(n(),C("div",ea,[i(ke,{sections:t(k).data,doctype:"CRM Lead",docname:t(o).data.name,onReload:t(k).reload,onAfterFieldChange:ne},null,8,["sections","docname","onReload"])])):u("",!0)])):(n(),d(me,{key:1,doctype:"CRM Lead",tabs:V.value,reload:D.value,"onUpdate:reload":e[3]||(e[3]=b=>D.value=b),tabIndex:t(p),"onUpdate:tabIndex":e[4]||(e[4]=b=>E(p)?p.value=b:null),modelValue:t(o),"onUpdate:modelValue":e[5]||(e[5]=b=>E(o)?o.value=b:null)},null,8,["tabs","reload","tabIndex","modelValue"]))]),_:1})]),_:1},8,["modelValue","tabs"])])):u("",!0),i(M,{modelValue:A.value,"onUpdate:modelValue":e[11]||(e[11]=s=>A.value=s),options:{title:a.__("Convert to Deal"),size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:se}]}},{"body-content":c(()=>[r("div",aa,[i(he,{class:"h-4 w-4"}),r("label",ta,I(a.__("Organization")),1)]),r("div",oa,[r("div",sa,[r("div",null,I(a.__("Choose Existing")),1),i(t(G),{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=s=>w.value=s)},null,8,["modelValue"])]),w.value?(n(),d(j,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:f.value,doctype:"CRM Organization",onChange:e[8]||(e[8]=s=>f.value=s)},null,8,["value"])):(n(),C("div",la,I(a.__("New organization will be created based on the data in details section")),1))]),r("div",na,[i(we,{class:"h-4 w-4"}),r("label",ia,I(a.__("Contact")),1)]),r("div",ra,[r("div",da,[r("div",null,I(a.__("Choose Existing")),1),i(t(G),{modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=s=>h.value=s)},null,8,["modelValue"])]),h.value?(n(),d(j,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:_.value,doctype:"Contact",onChange:e[10]||(e[10]=s=>_.value=s)},null,8,["value"])):(n(),C("div",ua,I(a.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{Xa as default};
//# sourceMappingURL=MobileLead-5f13df24.js.map
