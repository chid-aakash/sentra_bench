{"version":3,"file":"ContactModal-44664e22.js","sources":["../../../../frontend/src/components/Modals/ContactModal.vue"],"sourcesContent":["<template>\n  <Dialog v-model=\"show\" :options=\"{ size: 'xl' }\">\n    <template #body>\n      <div class=\"bg-surface-modal px-4 pb-6 pt-5 sm:px-6\">\n        <div class=\"mb-5 flex items-center justify-between\">\n          <div>\n            <h3 class=\"text-2xl font-semibold leading-6 text-ink-gray-9\">\n              {{ __('New Contact') }}\n            </h3>\n          </div>\n          <div class=\"flex items-center gap-1\">\n            <Button\n              v-if=\"isManager() && !isMobileView\"\n              variant=\"ghost\"\n              class=\"w-7\"\n              @click=\"openQuickEntryModal\"\n            >\n              <template #icon>\n                <EditIcon />\n              </template>\n            </Button>\n            <Button variant=\"ghost\" class=\"w-7\" @click=\"show = false\">\n              <template #icon>\n                <FeatherIcon name=\"x\" class=\"size-4\" />\n              </template>\n            </Button>\n          </div>\n        </div>\n        <FieldLayout\n          v-if=\"tabs.data?.length\"\n          :tabs=\"tabs.data\"\n          :data=\"_contact.doc\"\n          doctype=\"Contact\"\n        />\n      </div>\n      <div class=\"px-4 pb-7 pt-4 sm:px-6\">\n        <div class=\"space-y-2\">\n          <Button\n            class=\"w-full\"\n            variant=\"solid\"\n            :label=\"__('Create')\"\n            :loading=\"loading\"\n            @click=\"createContact\"\n          />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport FieldLayout from '@/components/FieldLayout/FieldLayout.vue'\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport { usersStore } from '@/stores/users'\nimport { isMobileView } from '@/composables/settings'\nimport {\n  showQuickEntryModal,\n  quickEntryProps,\n  showAddressModal,\n  addressProps,\n} from '@/composables/modals'\nimport { useDocument } from '@/data/document'\nimport { capture } from '@/telemetry'\nimport { call, createResource } from 'frappe-ui'\nimport { ref, nextTick, onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  contact: {\n    type: Object,\n    default: {},\n  },\n  options: {\n    type: Object,\n    default: {\n      redirect: true,\n      afterInsert: () => {},\n    },\n  },\n})\n\nconst { isManager } = usersStore()\n\nconst router = useRouter()\nconst show = defineModel()\n\nconst loading = ref(false)\n\nconst { document: _contact } = useDocument('Contact')\n\nasync function createContact() {\n  if (_contact.doc.email_id) {\n    _contact.doc.email_ids = [{ email_id: _contact.doc.email_id }]\n    delete _contact.doc.email_id\n  }\n\n  if (_contact.doc.mobile_no) {\n    _contact.doc.phone_nos = [{ phone: _contact.doc.mobile_no }]\n    delete _contact.doc.mobile_no\n  }\n\n  const doc = await call('frappe.client.insert', {\n    doc: {\n      doctype: 'Contact',\n      ..._contact.doc,\n    },\n  })\n  if (doc.name) {\n    capture('contact_created')\n    handleContactUpdate(doc)\n  }\n}\n\nfunction handleContactUpdate(doc) {\n  props.contact?.reload?.()\n  if (doc.name && props.options.redirect) {\n    router.push({\n      name: 'Contact',\n      params: { contactId: doc.name },\n    })\n  }\n  show.value = false\n  props.options.afterInsert && props.options.afterInsert(doc)\n}\n\nconst tabs = createResource({\n  url: 'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout',\n  cache: ['QuickEntry', 'Contact'],\n  params: { doctype: 'Contact', type: 'Quick Entry' },\n  auto: true,\n  transform: (_tabs) => {\n    return _tabs.forEach((tab) => {\n      tab.sections.forEach((section) => {\n        section.columns.forEach((column) => {\n          column.fields.forEach((field) => {\n            if (field.fieldname == 'email_id') {\n              field.read_only = false\n            } else if (field.fieldname == 'mobile_no') {\n              field.read_only = false\n            } else if (field.fieldname == 'address') {\n              field.create = (value, close) => {\n                _contact.doc.address = value\n                openAddressModal()\n                close()\n              }\n              field.edit = (address) => openAddressModal(address)\n            } else if (field.fieldtype === 'Table') {\n              _contact.doc[field.fieldname] = []\n            }\n          })\n        })\n      })\n    })\n  },\n})\n\nonMounted(() => {\n  _contact.doc = {}\n  Object.assign(_contact.doc, props.contact.data || props.contact)\n})\n\nfunction openQuickEntryModal() {\n  showQuickEntryModal.value = true\n  quickEntryProps.value = { doctype: 'Contact' }\n  nextTick(() => (show.value = false))\n}\n\nfunction openAddressModal(_address) {\n  showAddressModal.value = true\n  addressProps.value = {\n    doctype: 'Address',\n    address: _address,\n  }\n  nextTick(() => (show.value = false))\n}\n</script>\n\n<style scoped>\n:deep(:has(> .dropdown-button)) {\n  width: 100%;\n}\n</style>\n"],"names":["props","__props","isManager","usersStore","router","useRouter","show","_useModel","loading","ref","_contact","useDocument","createContact","doc","call","capture","handleContactUpdate","_b","_a","tabs","createResource","_tabs","tab","section","column","field","value","close","openAddressModal","address","onMounted","openQuickEntryModal","showQuickEntryModal","quickEntryProps","nextTick","_address","showAddressModal","addressProps"],"mappings":"60BAmEA,MAAMA,EAAQC,EAcR,CAAE,UAAAC,CAAW,EAAGC,EAAW,EAE3BC,EAASC,EAAU,EACnBC,EAAOC,EAAYN,EAAA,YAAA,EAEnBO,EAAUC,EAAI,EAAK,EAEnB,CAAE,SAAUC,GAAaC,EAAY,SAAS,EAEpD,eAAeC,GAAgB,CACzBF,EAAS,IAAI,WACfA,EAAS,IAAI,UAAY,CAAC,CAAE,SAAUA,EAAS,IAAI,SAAU,EAC7D,OAAOA,EAAS,IAAI,UAGlBA,EAAS,IAAI,YACfA,EAAS,IAAI,UAAY,CAAC,CAAE,MAAOA,EAAS,IAAI,UAAW,EAC3D,OAAOA,EAAS,IAAI,WAGtB,MAAMG,EAAM,MAAMC,EAAK,uBAAwB,CAC7C,IAAK,CACH,QAAS,UACT,GAAGJ,EAAS,GACb,CACL,CAAG,EACGG,EAAI,OACNE,EAAQ,iBAAiB,EACzBC,EAAoBH,CAAG,EAE3B,CAEA,SAASG,EAAoBH,EAAK,UAChCI,GAAAC,EAAAlB,EAAM,UAAN,YAAAkB,EAAe,SAAf,MAAAD,EAAA,KAAAC,GACIL,EAAI,MAAQb,EAAM,QAAQ,UAC5BI,EAAO,KAAK,CACV,KAAM,UACN,OAAQ,CAAE,UAAWS,EAAI,IAAM,CACrC,CAAK,EAEHP,EAAK,MAAQ,GACbN,EAAM,QAAQ,aAAeA,EAAM,QAAQ,YAAYa,CAAG,CAC5D,CAEA,MAAMM,EAAOC,EAAe,CAC1B,IAAK,yEACL,MAAO,CAAC,aAAc,SAAS,EAC/B,OAAQ,CAAE,QAAS,UAAW,KAAM,aAAe,EACnD,KAAM,GACN,UAAYC,GACHA,EAAM,QAASC,GAAQ,CAC5BA,EAAI,SAAS,QAASC,GAAY,CAChCA,EAAQ,QAAQ,QAASC,GAAW,CAClCA,EAAO,OAAO,QAASC,GAAU,CAC3BA,EAAM,WAAa,YAEZA,EAAM,WAAa,YAD5BA,EAAM,UAAY,GAGTA,EAAM,WAAa,WAC5BA,EAAM,OAAS,CAACC,EAAOC,IAAU,CAC/BjB,EAAS,IAAI,QAAUgB,EACvBE,EAAiB,EACjBD,EAAM,CACR,EACAF,EAAM,KAAQI,GAAYD,EAAiBC,CAAO,GACzCJ,EAAM,YAAc,UAC7Bf,EAAS,IAAIe,EAAM,SAAS,EAAI,CAAC,EAE/C,CAAW,CACX,CAAS,CACT,CAAO,CACP,CAAK,CAEL,CAAC,EAEDK,EAAU,IAAM,CACdpB,EAAS,IAAM,CAAC,EAChB,OAAO,OAAOA,EAAS,IAAKV,EAAM,QAAQ,MAAQA,EAAM,OAAO,CACjE,CAAC,EAED,SAAS+B,GAAsB,CAC7BC,EAAoB,MAAQ,GAC5BC,EAAgB,MAAQ,CAAE,QAAS,SAAU,EAC7CC,EAAS,IAAO5B,EAAK,MAAQ,EAAM,CACrC,CAEA,SAASsB,EAAiBO,EAAU,CAClCC,EAAiB,MAAQ,GACzBC,EAAa,MAAQ,CACnB,QAAS,UACT,QAASF,CACX,EACAD,EAAS,IAAO5B,EAAK,MAAQ,EAAM,CACrC"}